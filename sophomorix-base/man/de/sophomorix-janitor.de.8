.\"                                      Hey, EMACS: -*- nroff -*-
.\" First parameter, NAME, should be all caps
.\" Second parameter, SECTION, should be 1-8, maybe w/ subsection
.\" other parameters are allowed: see man(7), man(1)
.TH SOPHOMORIX-JANITOR 8 "June 04, 2015"
.\" Please adjust this date whenever revising the manpage.
.\"
.\" Some roff macros, for reference:
.\" .nh        disable hyphenation
.\" .hy        enable hyphenation
.\" .ad l      left justify
.\" .ad b      justify to both left and right margins
.\" .nf        disable filling
.\" .fi        enable filling
.\" .br        insert line break
.\" .sp <n>    insert n+1 empty lines
.\" for manpage-specific macros, see man(7)
.SH NAME
sophomorix-janitor \- Hausmeister von sophomorix
.SH SYNOPSIS
.B sophomorix-janitor
.RI [ options ]
.br
.SH DESCRIPTION
.B sophomorix-janitor  
bereinigt sophomorix von ungenutzen Daten, z.B. am Schuljahresende
.br
WARNUNG:Im Moment ist sophomorix-janitor noch experimentell. Es wird
empfohlen, dass man Daten erst entfernt nachdem man sich überzeugt
hat, dass sie nicht mehr benötigt werden.
.PP
.SH ALLGEMEINE OPTIONEN
.B sophomorix-janitor
benützt die GNU command line syntax, mit langen Optionen, die mit zwei
Bindestrichen (`-') beginnen:
.TP
.B \-h, \-\-help
Kurzübersicht über Optionen, sowie eine Liste der eingelesenen Dateien.
.TP
.B \-v, \-\-verbose
Sagt, was das Programm gerade macht (verbose)
.TP
.B \-vv, \-\-verbose \-\-verbose
Sagt ungeheuer genau, was das Programm gerade macht (very verbose)
.TP
.SH Unowned Files finden und bearbeiten
.TP
.B --find-unowned-files
Findet und zählt verwaiste Dateien/Ordner in /home/share und listet deren
uidnumber und Datei/Ordneranzahl.
.TP
.SH FILESYSTEM-ACLS entfernen
.TP
.B --aclhomeshare-remove-uidnum
Entfernt alle ACLs des Verzeichnisses /home/share , die zu Usern oder
Gruppen gehören, die nicht mehr existieren (und deshalb zu einer
uidnumber gehören)
.TP
.B --aclhomeshare-remove-all-users
Entfernt alle ACLs des Verzeichnisses /home/share, die Usern
gehören. Diese ACLs werden angelegt, wenn für einen user das tauschen
global verboten wird.
.SH DATEIEN ZUM BEGUTACHTEN KOPIEREN/VERSCHIEBEN 
Beim Begutachten wird mit den Daten EINES Users folgendes gemacht:
. IP \(em 3
Die Daten werden beim Kopieren/Verschieben dem User root
überantwortet. Damit wird das Festplatten-Quota des Users entlastet.
. IP \(em
Beim Verschieben werden die Daten exakt gleich wie beim Kopieren
zuerst aus der Quelle ans Ziel kopiert. DANACH werden allerdings die
Quelldaten gelöscht (Verschieben dauert also länger als kopieren).
. IP \(em
Im Zielverzeichnis gibt es das
Log-Verzeichnis .sophomorix-janitor. Dort finden sich die
Informationen, die beim Verschieben verloren gehen würden (owner,
groupowner, atime, mtime, ctime der Quelledaten).
. IP \(em
In Zukunft wird es ein cronjob geben, der nach der abgelaufenen Zeit
die zu begutachtenden Daten löscht.
.TP
Zeitlicher Ablauf beim Verschieben/Kopieren:
.TP
. IP \(em 
Schritt 1: Dateien des Users werden mit demselben relativen Pfad
kopiert/verschoben. Dazu benötigte übergeordnete Verzeichnisse werden
angelegt.
. IP \(em
Schritt 2: Verzeichnisse brauchen wegen Schritt 1 nicht mehr
kopiert/verschoben zu werden. Beim Verschieben werden leer gewordene
Verzeichnisse der Quelle entfernt. Nicht leer gewordene Verzeichnisse
der Quelle die dem User gehören, werden demjenigen User überantwortet,
der die meisten Dateien in dem Verzeichnis besitzt.
. IP \(em
Schritt 3: Links werden nicht kopiert/verschoben.
. IP \(em
Schritt 4: Alle restlichen Daten werden nicht kopiert/verschoben.
.br 
.SH GRUNDLEGENDE OPTIONEN ZUM BEGUTACHTEN:
Optionen ohne Angabe des Zielverzeichnisses (für
Spezialfälle. Normalerweise reichen die SHORTCUT-Optionen weiter unten):
.TP
.in 3
.B --find-files /quelle --owner uid
Auflisten einer Übersicht der Daten eines Users im Verzeichnis /quelle 
.TP
.in 3
.B --find-files /quelle --owner uid -v
Ausführliches Auflisten der Daten eines Users im Verzeichnis /quelle 
.TP 
.in 3
.B --find-files /quelle --owner uid/uidnumber --new-owner newuid/newuidnumber
Übereignen der Daten eines Users uid im Verzeichnis /quelle
an den User newuid/newuidnumber
.TP
Optionen mit Angabe des Zielverzeichnisses: 
.TP 
.in 3 
.B --find-files /quelle --owner uid/uidnumber --copy-to /ziel
Kopieren der Daten eines Users vom Verzeichnis /quelle nach /ziel
.TP 
.in 3
.B --find-files /quelle --owner uid/uidnumber --move-to /ziel
Verschieben der Daten eines Users vom Verzeichnis /quelle nach /ziel
.TP 
Mit Zielverzeichnis /quelle/login_bleibt_erhalten_bis_DATUM:
.TP 
.in 3
.B --copy-to-review /quelle --owner uid --review-days num
Kopieren der Daten eines Users im Verzeichnis /quelle
.TP 
.in 2
.B --move-to-review /quelle --owner uid --review-days num
Verschieben der Daten eines Users im Verzeichnis /quelle
.TP
Die Option --review-days ist optional. Standardwert: 366 Tage.
.TP
Die Option --uid kann sowohl uid-Name als auch uid-Number enthalten. 
.br
.SH SHORTCUT-OPTIONEN ZUM BEGUTACHTEN
Dies sind die Optionen, die üblicherweise ausreichen, wenn ein User
mit Daten in den Tauschverzeichnissen aus dem System entfernt wird.
.TP
Begutachten der Dateien in $HOME eines Users 
(Ziel: $HOME/login_bleibt_erhalten_bis_DATUM):
.TP 
.in 3
.B --move-to-review-home login --review-days num
.TP
.in 3
.B --copy-to-review-home login --review-days num
.TP
Begutachten der Dateien im Tauschverzeichnis der Lehrer 
(Ziel: LehrerTausch/login_bleibt_erhalten_bis_DATUM):
.TP 
.in 3
.B --move-to-review-teacher login --review-days num
.TP
.in 3
.B --copy-to-review-teacher login --review-days num
.TP
Die Option --review-days ist optional. Standardwert: 366 Tage.
.TP
Begutachten der Dateien in allen Projekt-Tausch-Verzeichnissen 
(Ziel: login_bleibt_erhalten_bis_DATUM im jeweiligen Projekt-Tausch-Verzeichnis):
.TP 
.in 3
.B --move-to-review-share-project login --review-days num
.TP
.in 3
.B --copy-to-review-share-project login --review-days num
.TP
Begutachten der Dateien in allen Klassen-Tausch-Verzeichnissen
(Ziel: login_bleibt_erhalten_bis_DATUM im jeweiligen Klassen-Tausch-Verzeichnis)::
.TP 
.in 3
.B --move-to-review-share-class login --review-days num
.TP
.in 3
.B --copy-to-review-share-class login --review-days num
.br
.SH OPTIONEN FÜR DATENBANK TOOLS:
.TP 
.B --check-horde
Sucht in der Horde3-Datenbank in der Tabelle horde_prefs nach
Einträgen von Usern, die im System nicht mehr existieren.
.TP
.B --dump-pg-ldap
Dumpt die pstgresql Datenbank ldap der Benutzerverwaltung mit
Datumsstempel ins übliche Verzeichnis.
.TP
.B --list-db-junk / --kill-db-junk
Sucht/Löscht in der Benutzerdatenbank nach folgendem Müll
(Nichtexistente Gruppen als Mitglieder in Projekten)
.br
.SH OPTION ZUR SUCHE NACH FREMD-DATEIEN
.TP
.B --list-foreign-files
Listet Dateien im Heimatverzeichnis des Users auf, die nicht dem User
gehören. Die Spezialverzeichnisse __austeilen, __tauschen, ... und
deren Inhalt werden NICHT gelistet
.br
.SH OPTIONEN ZUR ANGABE VON USERN:
.TP
Die Auswahl erfolgt anhäufend. Das bedeutet, dass durch Angabe
mehrerer Optionen eine Userliste erzeugt wird, in der kein User
doppelt vorkommt, aber jeder enthalten ist.
.TP
.B -u User1,User2,... / --users User1,User2,... 
.TP
.B -c class1,class2,... / --class class1,class2,...
Als Klasse kann auch <teachers> angegeben werden.
.TP
.B --project project1,project2,...
.TP
.B -r raum1,raum2,... / --room raum1,raum2,...
.TP
.B -s / --students
.TP
.B -w / --workstations 
.TP
.TP
.SH SEE ALSO
.BR sophomorix (8),
.BR sophomorix-teach-in (8),
.BR sophomorix-add (8),
.BR sophomorix-move (8),
.BR sophomorix-print (8),
.BR sophomorix-kill (8),
.BR sophomorix-subclass (8),
.BR sophomorix-project (8),

.\".BR baz (1).
.\".br
.\"You can see the full options of the Programs by calling for example 
.\".IR "sophomrix-janitor -h" ,
.
.SH AUTHOR
Written by <jeffbeck@web.de>.
