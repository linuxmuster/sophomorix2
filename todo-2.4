


renaming users:

- /var/lib/cyrus/lock/w/user/wenzlpa.lock des alten users existiert noch.
  (Was tun???)




Ehemalige (Pension, Schulwechsel, Krankheit, ...):
----------------------------------------------------
Testen: verschieben in extraschueler (geht, Home OK)
        rückverschieben (geht, Home OK)
        was passiert mit Gruppenmitgliedschaften des Lehrers?
        was passiert mit Daten aus tausch?


Was soll mit den Daten der ehemalige Lehrer geschehen?
  Voraussetzungen: Kürzel/Loginname bleibt erhalten (Mailadresse)
  Name der Gruppe: ehemalige, ruhestaendler (ohne Umlaut)
  Dauer der Bereithaltung nach entfernen: 1 Monat oder 1 Jahr 
  Testen: kann Lehrer in neue Klasse versetzt werden

Ablauf:
1) Kollegin x,y,z erhält Info:
    A) Alle Daten in Tauschverzeichnissen löschen
    B) Daten in Tauschverzeichnissen zur Verfügung stellen
2) Falls zur Verfügung stellen:
   1) Daten werden in allen Tauschverzeichnissen herausgesucht (entfernt)
   2) Sie werden 1 Woche fuer x,y,z im ehemaligentausch bereitgehalten 
      (nur von x einsehbar,loeschbar) -> Aussortieren
   3) Nach dieser Woche werden die Abteilungsleiter(kollegium) 
      informiert (1 Mail):
      - Daten von x,y,z liegen in __Tausch_ehemalige/_ehemelige/[x,y,z]
      - Bitte holen Sie Daten, die noch gebraucht werden 
        (wieder ins Tausch sortieren, privat, ...)
        Achtung: Urheberrecht
   4) Daten im Lehrertausch werden nach 1 Monat unwiederruflich geloescht    

Was ist mit schon geloeschten usern?
    -> Daten sind unter uid gespeichert 
       (ehemaliger Eigentuemer kann nicht sicher zugeordnet werden)
    Vorgehen wie oben:
    1) Daten unter uidnumber heraussuchen
    2) -- evtl. checken (Netzwerker) 
    3) Info an Kollegium: Daten checken
       Achtung: Urheberrecht, Urheber versuchen zu befragen
    4) loeschen

Befehle:

sophomorix-user --retire user
  -> moved user in die schuelergruppe ehemalige (konfigurierbar)
  -> sucht Daten in Tausch und stellt sie ins Tausch der ehemaligen
  -> cronjob schaltet sie nach x Tagen frei
  -> cronjob loescht sie nach y Tagen

sophomorix-janitor --retire-data 25537748  (unix uid)

sophomorix-janitor --show-retired-data
-------+---------+---------+
       | public  | delete  |
  uid  | review  |  Data   |
       | 30 days |   in    |
-------+---------+---------+
12449  | 30 days | 36 days |
13447  | 24 days | 24 days |
14123  | ------- | Deleted | -> nicht mehr zeigen oder archivieren

- evtl. noch mit Bemerkungen hintendran (vermutlich ..., )
- evtl. mit admin review statt personal review

sophomorix-user --show-retired
  -> listed user der Gruppe ehemalige (konfigurierbar)
-------+-----------+---------+---------+------------+
       | personal  | public  | delete  | Retirement |  
  user |  review   | review  |  Data   | Date       |
       |  7 days   | 30 days |   in    |            |
-------+-----------+---------+---------+------------+
humpf  |  6 days   | 30 days | 36 days | 2013-08-02 |
gampf  |  ------   | 24 days | 24 days | 2013-08-02 |
gampf  |  ------   | ------- | Deleted | 2013-08-02 |
 
Ordnung ist nach Datum
Bei geloeschten usern 







Updating postgres on slapd changes

slapd overlay: slapo-sock soll script starten können
               speziell mit passworte smbk5pwd 
back-perl
back-shell
http://www.openldap.org/devel/gitweb.cgi?p=openldap.git;a=blob;f=servers/slapd/back-perl/SampleLDAP.pm;h=341f2b02e709f183ef42204773f11518dfdea547;hb=refs/heads/master

Logged in ldif mit: auditlog overlay
univention logged  mit (eigenem overlay translog)
univention: translog im Paket slapd, (scheint von univention zu sein)

sophomorix-print 
  - delete sophomorix-print-date on logout/after certain time, ...

# sophomorix-user --backup-data user --path /abs/path
  - backup of userhome in ein anzugebendes Verzeichnis
  - backup von metadata (olduserid, ...)
  sophomorix-user --restore-data user --path /abs/path
  
  - sollte auch bei neuem username, neuer id gehen.
  - Tauschverzeichnisse

# sophomorix-janitor
  -- Sonderquota checken:
   user in quota.txt und mailquota.txt (evtl. Klassen/Projekte) haben 
   noch (Sonder)quota, obwohl user,klassen,projekte nicht mehr existieren
   (cronjob, monthly)
  -- ungenutzte $HOME in /home/attic finden:
   alle dirs in /home/attic/username durchgehen, gibts username noch?
   löschen oder warnen (Monthly cron)
  

   --olduserid --newuserid --ask (nachfragen)
  Ändert die userid von Dateien 
  im angebbaren absoluten Pfad (Default: home/share)
# cronjob: a) Prüft, ob die in Projekten enthaltenen admins/user noch im 
              system sind.(Monatlich)
           b) Projekte ohne admin melden
           ? wird beim löschen eines users, seine Projektmemberships entfernt
             (sollte nur bei members so sein)
          
  Überantworten der Projektleitung mit --addadmin neu --removeadmin alt
  sophomorix-user -u login
     Auflisten von Projektleitungen (auch mit wem zusammen)
     (Wenns den user nicht gibt, dann in History gucken)




# 299 Testen -> 5.2.0
  -> sophomorix-janitor

# Idee:
# popularity contest: mitloggen, welche features benutzt werden
# damit Entscheidungen treffen, was weitergepflegt wird
# evtl. schon vorhandene logdateien auswerten


return Values of all sophomorix scripts are 0 on success (like perl)
-> must be changed, what about schulkonsole?



Datenschutz: 
- Online-Verfahrensverzeichnis: https://vvbw.kultus-bw.de
- Logdateien: 4 Wochen aufheben
- VLAN ist physikalische Trennung



user-modify.archive.log  <---> user-modify.log
user archived nur hier
                    new unid bei beiden
auto teach-in -> Richtig einordnen
update unids  -> Richtig einordnen

sophomorix-user -u login 
--> alle user zeigen, auch gelöschte aus user-archive.log
sophomorix-user -uidnumber 123456
-> zeige Infos zu user, auch wenn schon gelöscht 



###### ubuntu 11.10 installation 2.2.22
perl-suid gibts nicht mehr

nicht automatisch installiert, wieso?
libquota-perl
texlive-latex-extra
libstring-approx-perl
libimap-admin-perl
zip
libnet-mac-perl
texlive-lang-german
samba
setuid-perl dummy package gebaut (file evtl. mit perl-suid ersetzen):

1. aptitude install equivs
2. equivs-control file
3. emacs file
   Package name: perl-suid
   Architecture: all
4. equivs-build file 



Probleme:
- Paket nscd nicht standardmäßig installiert
- Services neu starten ist anders
    /sbin/service smb restart 
    /sbin/service smb reload

    -> Übersicht: /usr/sbin/service --status-all

- bei smbd auch nmbd neu starten?
- postgresql
    postgres shell als root
    sudo -u postgres psql
postgresql update scripts können nicht mit postgres verbinden
--> muss user postgres sein

Problems:

Folgender Fehler, vermutlich durch get_smb_sid
[2011/12/14 19:40:45.817420,  0] lib/smbldap.c:731(smb_ldap_start_tls)
  Failed to issue the StartTLS instruction: Protocol error

--> trotzdem gibts eine sid in $sid

bei sudo postgres: 
could not change directory to "/root/sophomorix2"
Das ist das Verzeichnis, aus dem das script gestartet wurde


pg_hba.conf:

# unix-socket 
# als user ldap
# für db ldap
# identität feststellen mit der map ldap 
# pg_ident.conf:  ldap  root ldap
local   ldap    ldap     ident   map=ldap # kommt dazu
local   all     all      peer             # existiert schon





###### ubuntu 11.10 installation 2.2.22







# openQRM:  Verwaltung von Virtuellen Rechnern

# mal testenn
Lehrer kommt wieder zurück -> Links, die nirgendwo mehr hinzeigen
--> beim disablen sollte der Lehrer aus allen Gruppen genommen werden

sophomorix-passwd:

weitere Sonderzeichen zulassen

Bisher:  @?,%.:

Noch dazu: # =

Zusätzliche Passwörter von Rainer

Wichtig: 
- auch beim Drucken mit Latex müssen die richtigen Zeichen erscheinen
- auch auf der Schulkonsole-Seite korrekt erscheinen
- auch beim erstanlegen




sophomorix-janitor:
alle Klassen bei allen Lehrern entfernen. 
sinnvoll am Schuljahresende?

Folgenden Befehl checken:
sophomorix-groupdel --delete-all-empty-classes --remove-teachers


Projektmitgliedschaften ohne dass das Projekt existiert. #540



sophomorix-user --old-id
   search for old username/firstname/lastname in user-modify.log


Todo:

migration: linuxmuster-migration
evtl. eigenes Paket namens sophomorix-migration
- sambasid soll gleich bleiben
- Zieldir angeben
- 


add to string at beginning of 
configfiles on what template it is based (absolute path)

Wieviele user haben unowned files (Anzahl der uid)

########################################
Homeverzeichnisse und Tauschverzeichnisse mit git?
 + offline Betrieb möglich (Android Tablets m AGit)
 + history möglich
 + Programmieren, ...

Gir Repos für:
- homes
- klassentausch
- projekte

Platz schaffen (automatisiert):
- 1. auschecken
- 2. .git löschen, git init
- 3. auf server Repositoory löschen, neu anlegen
- 4. wieder einchecken
(oder gibts Befehl: remove history)



mit gitolite möglich:
- für jeden user einen ssh-key erzeugen 
  (spezialname damit er nicht so leicht überschrieben wurd)
- ssh-add .ssh/keyname -->> dann ist zugriff möglich
  (Button mit Namen Schulserver)
- innerhalb modul ein dir mit 
   read nur für lehrer (Notizen, ...)
   write nur für den Lehrer (Anleitungen, Arbeitsblätter)

gitolite.conf

include für users.conf # homes
include für adminclass.conf # Klassentausch
include für projects.conf


in projects.conf
jeweils 10 user pro zeile um die gruppe zu definieren
dann die jeweiligen Permissions





   tauschverzeichnisse wie aktualisieren


########################################


Todo:

slapd.conf template updaten



sophomorix-check --recovery /var/....

sophomorix-support ....prepare for dist upgrade
  - verschlüsselte passwörter dumpen:   (extra option, bei prepare-for dist-upgrade gesetzt)
    uid::sambalmpassword::sambantpassword::userPassword::firstpassword
  - SID???
sophomorix-passwd --update-encryped-passwords-from-file


beim versetzen testen, ob soft quota überschritten wird 
(in Datei ausgeben nach ... report.office/quota)

Idee: Versetzen-Report:
- bei welchen Schülern wurde das quota durch versetzen überschritten?
- sonstiges?



sophomorix-repair: zusatzoption, damit auch symlinks ALLER user repariert werden
                   (aufruf von sophomorix-user --repairhome für alle user)
sophomorix-user --repairhome (wie reset-user, aber ohne zu löschen)


###### 05.09.2011 #######

sophomorix-setup-pgldap auf minimale Dinge reduzieren, 
wenn ...linuxmuster-base da
sonst: alles Konfigurieren




sticky bits weg
keine force groups/create mode, .... in smb.conf


Fragen: 
1) directory mode weg?
2) wide Links
3) suid guid auch weg
4) Ordner,Links vor dem löschen sichern wie?
5) immutable bit von ext3 filesystem zusätzlich nutzen

ueberlegen, welche default acls gesetzt werden sollen

/home/share/classes/KLASSE 

/home  mit acl mounten

cp -a/mv -a 
cp -r ()
rsync --acl, tar nicht mehr sondern star

Umsetzung:
####################################

# sticky bit entfernen
chmod u-s,g-s,o-t -R /home/share

# fuer neu anzulegende 
setfacl -d -m g:teachers:rwx /dir/to/dir
-d : defaultacl
-m : modify

# fur bestehende
setfacl -R -m g:teachers_rwx 
(besser: mit --mask neu berechnen lassen)



Entfernen von allen acls:

setfacl -R -b /dir/to/dir



sophomorix-repair fuer acl anpassen:

Paketname: acl


1) optionen --with-acl     (zukünftiger default) 
        und --without-acl  (momentaner default)
2) sophomorix-base/config-devel/repair.directories anpassen

   zusatzoptionen (checken, ob für immutable bit schon was benutzt wird)

   A) erste Zusatzoption:
   welche(r) (rekursive) Befehl(e) sind notwendig, um alle Datein im Verzeichnis
   mit acl's zu versehen

   B) zweite Zusatzoption:
   welcher Befehl ist notwendig, um im directory alle acls zu entfernen?

   Zum testen: sophomorix-repair --acl-only-class klasse 
               schränkt das auf eine bestimmte Klasse ein




sophomorix-class -i -c tg12 sollte sinnvolle liste anzeigen
alle user in der Klasse, Account status, ....

Wenn Schüler im sytem in tg11 sind und in schueler.txt in TG11
kommt in report.office ein Fehler: doppelter Datensatz -> majestix
Obwohl nur je 1 Zeile existiert


Testen: wenn bei einem disableden user das Passwort geaendert wird, kann er sich wieder anmelden (roe)


funktion: collect unowned files, abspeichern unter id/gid

Bug #411
anlegen Lehrer mit GebDat: 0.01.1970



Userwunsch:

zusätzliche Gruppe für alle user (schueler) für egroupware konfiguration




Zusammenarbeit mit import_workstations:

-> nur Räume mit Kleinbuchstaben zulassen. (# 368)
Wie soll das gehen? 
  * Räume mit Großbuchstaben zu Kleinbuchstaben konvertieren!
  * Gruppennamen mit Großbuchstaben zu Kleinbuchstaben konvertieren!
  * MAC immer groß!
  -> dito in sophomorix-workstation umsetzen


sophomorix-janitor (was sophomorix-end-of-year)
   - remove content of share-directories
        - exclude classes of type extra
        - exclude projects
   - collect unowned files, abspeichern unter id/gid
          --> /home/attic/_unowned
          ??? nice wert anpassen ???
   - archive data before being unowned
       archiving data from deleted teachers in share
       archiving data for purposes (oes,software downloads)
                 data managed by group netzwerker in Tausch-Lehrer

mit repquota sieht man noch belegten Platz von uid's
diese sollte man suchen, wegarchivieren





# 89 /var/upgrade/linuxmuster/<paketname>
# 282 Links zu Projektverzeichnissen
>>>>>>> 1.269



mv: Aufruf von stat für "/home/share/classes/bej2g/~ Bal6.doc" nicht möglich: Datei oder Verzeichnis nicht gefunden




Backup to here: 
   /home/students/tg111/dagmxxxxsi/__dachboden/tausch-2010-09-17_17-41-33/
Use of uninitialized value $owner in string eq at /usr/share/perl5/Sophomorix/SophomorixBase.pm line 1116, <USERVERSETZEN> line 1700.
group tg121 exists already (10036)
Replacing ldap group dn: cn=tg121,ou=groups,dc=abyyyyx,dc=de
GLOBIGNORE=/; rm -rf /home/students/tg111/dagmxxxxsi/__austeilen/austeilen-tg111
group tg121 exists already (10036)




#### Moving User diaxxxxxxn (1680) to another class:                        ####
Linux-Gruppe (Alt):    2bfw21
Linux-Gruppe (Neu):    1bk1w1
Altes Home:            /home/students/2bfw21/diaxxxxxxn
Neues Home:            /home/students/1bk1w1/diaxxxxxxn
Neues Homedir:         /home/students/1bk1w1
Alter Status:          E
Look in class share: /home/share/classes/2bfw21
Backup to here: 
   /home/students/2bfw21/diaxxxxxxn/__dachboden/tausch-2010-09-17_17-40-08/
     * Move: Dok4.doc (owner: diaxxxxxxn)
     * Move: Strasse in Pompeji.doc (owner: diaxxxxxxn)
Use of uninitialized value $owner in string eq at /usr/share/perl5/Sophomorix/SophomorixBase.pm line 1116, <USERVERSETZEN> line 1680.
     * Move: Teneriffa hat viele Gesichter.doc fRANcE.doc (owner: diaxxxxxxn)
     * Move: Wetterkapriolen.doc (owner: diaxxxxxxn)
Use of uninitialized value $owner in string eq at /usr/share/perl5/Sophomorix/SophomorixBase.pm line 1116, <USERVERSETZEN> line 1680.
     * Move: Vesuv.doc (owner: diaxxxxxxn)
group 1bk1w1 exists already (10059)
Replacing ldap group dn: cn=1bk1w1,ou=groups,dc=abyyyyx,dc=de
GLOBIGNORE=/; rm -rf /home/students/2bfw21/diaxxxxxxn/__austeilen/austeilen-2bfw21
group 1bk1w1 exists already (10059)
Replacing ldap group dn: cn=1bk1w1,ou=groups,dc=abyyyyx,dc=de


Verbesserung: Wenn kein owner gefunden wird, dann 
nach /home/.../unowned files verschieben
(wo soll das sein)



sophomorix-class -i -c klasse
  -> auflisten der Mitglieder einer Klasse
     (Login und gecos was noch?)

sophomorix-workstation:

neue Optionen: --hosts-up, --hosts-down
                 : Hosts mit nmap -sC (oder so) ermitteln, ob up or down
                 : up listen, bzw. down listen
               --file bzw. --db, --diff
                 Was soll als Grundlage genutzt werden
                 Datei oder Datenbank/System



Test1:

0) emacs cvs instalieren, siehe
   http://lml.support-netz.de/trac/blog/Etch-Repos_verschoben


1)  neues script dazukopieren und ausführen
    # sophomorix-dump-dist-upgrade

lenny64:/mnt/cvs-adler/sophomorix2# ls -l /var/log/sophomorix/dist-upgrade/
insgesamt 116
-rw-r--r-- 1 root root 15624 14. Sep 18:18 group
-rw-r--r-- 1 root root 84909 14. Sep 18:18 passwd
-rw-r--r-- 1 root root  3223 14. Sep 18:18 sophomorix_passwords
-rw-r--r-- 1 root root  2207 14. Sep 18:18 sophomorix_projects
-rw-r--r-- 1 root root     0 14. Sep 18:18 teach-in.txt
-rw-r--r-- 1 root root  1535 14. Sep 18:18 user_db

2) # sophomorix-setup-pgldap --new-database
   -> neue leere Datenbank


3) !!! 2 Zeilen in sophomorix-check auskommentieren ca. Zeile 3268

            # only in 2.x ???
         #   $identifier=~tr/A-Z/a-z/;
         #   $identifier=~s/-//g;

   sophomorix-check --get-info-from-old-files /var/log/sophomorix/dist-upgrade --no-auto-teach-in --use-uid --use-gid 

4) Anzulegende user testen:

   !!! Zeilen modifizieren in sophomorix-add
                         $pg_timestamp,   # zeile 407 
                         "",
                         $wunsch_id,
                         undef,
                         undef,
                         undef,
                         $wunsch_gid
                        );




   Einige zeilen in SophomorixPgldap.pm ersetzen 
   (von begin neu (1472) bis ende neu sowie 2 Zeilen darüber und Zeile 1669)



   # sophomorix-add -i
   !!!Achtung user, ohne id,gid entfernen aus sophomorix.add
   (später Option dafür machen in sophomorix-add)
   --only-with-id
   --only-with-gid 

   # sophomorix-add

   evtl find, siehe unten

5) Projects wieder einspielen -> sollte tun

   sophomorix-project --create-from-file /var/log/sophomorix/dist-upgrade/sophomorix_projects

!!!!!!!!!!!!!!!!!! die gid sus der datei wird nicht benutzt

Idee: Die Datenbank auf die für das Projekt nötige gid stellen:
  1) UPDATE posix_account set gidnumber=10015 WHERE uid='NextFreeUnixId';
  2) projekt anlegen für diese gid: sophomorix-project --create -p p_name
  3) 1,2 wiederholen für alle projekte


6) Passwörter
   A) Update nur in postgres
      # sophomorix-passwords-into-pgldap
   B) weitergeben nach ldap:   
      # sophomorix-dump-pg2ldap 

7) import_workstations
   Suche die Größte uid und gid:
   select uid,uidnumber,gidnumber from posix_account WHERE uid='NextFreeUnixId';
   --> 10051 10005

   Welches ist die größte uidnumber? 11785
   select uid,uidnumber,gidnumber from posix_account ORDER BY uidnumber; 
   Welches ist die größte gidnumber? 10014
   select uid,uidnumber,gidnumber from posix_account ORDER BY gidnumber; 

NextFreeUnixId eins darüber setzen:
  UPDATE posix_account set uidnumber=11786 WHERE uid='NextFreeUnixId';
  UPDATE posix_account set gidnumber=10015 WHERE uid='NextFreeUnixId';

-> tut auch für import_workstations

Cleanup:
find nach Dateien, die keinem user gehören

find /home -nouser -printf "%u %g %p\n"
find /home -nogroup -printf "%u %g %p\n"




Problem: import workstations 
  (sophomorix-workstation) sollte auch mit der bisherigen id anlegen.
  oder alte accounts löschen und neue anlegen (--recreate-accounts)




1. Postgres Datenbank sichern

2. sophomorix-setup-pgldap --new-database
   (legt leere Datenbank wieder an)
3. 


Schule Ludwigsburg:
  - zuerst mit Datei schueler.txt VOR den Problemen 
  - dann mit aktueller Schülerdatei
  - Alle Passwörter ändern sich (könnten aber evtl gedumped werden)
  - Externes Moodle

Daten, die verloren gehen:
  - Lehrer, die sich in Klassen eingetragen haben
  - Projekte?
  - Passwörter?
  - user im attic fallen weg (Daten müssen manuell gelöscht werden)
    getent passwd | grep attic (wie findet man disabled user, die nicht in ?)
  ldap=> select uid,surname,firstname,sophomorixstatus from userdata WHERE sophomorixstatus='T' or sophomorixstatus='R' or sophomorixstatus='K';
  - Einstellungen in Klassen (sophomorix-class -i)
  - Klassentauschverzeichnisse von nicht mehr existierenden Klassen 
    gehören keinem gruppenowner mehr -> löschen




Testen am lmz:

- geht das mit Version des Kunden?






Zusatzschema-Datei/oneiric:

sophomorix.schema scheint OK
Funktion in perl zum synchronisieren des accounts tut

Mit slapadd einlesbar wenn -f /etc/ldap/slapd angegeben.

Umsetzung:
1. sophomorix.schema (weitere Werte)
2. in sub update_user_ldap in SophomorixPgLdap.pm:
   my @objectclass= ... sophomorixData dazu (Zeile einkommentieren)
   --> weitere werte dazu
3. Beim add(ungetestet),modify(getestet) für jedes Feld hinzu
        sophomorixstatus             => $sophomorixstatus,
        (vorher status holen)
4. beim dump zum sql auch die entsprechenden Einträge erzeugen (tut)
5. Beim konvertieren zu ldif gucken, dass nichts behindert wird
 




Bugfix: Wenn ein user ln posgres/ldap gelöscht wird, bleibt in horde seine 
settings zurück.

Kommt nach dem Löschen erneut ein user mit demselben loginnamen,
so hat er dessen Einstellungen.

Um den user auch in horde zu entfernen sollte in der datenbank horde 
folgender Befehl abgesetzt werden:

DELETE from horde_prefs where pref_uid="wag";

oder besser das horde application framework benutzt werden, um einen
user komplett zu löschen.




sophomorix-teacher  -i --teacher bz:
 - output alphabetisch ausgeben
 - andere lehrer anzeigen (alphabetisch)




sophomorix-virus:

Herauspicken der was wohin, owner,gowner war nicht möglich:


####### Predicted size of Scan Object:            501 MB #######
/home/teachers/ke/_auszuteilen/Wechseldatenträger (E)/RavMon.exe: Trojan.Agent-1914 FOUND
/home/teachers/ke/_auszuteilen/Wechseldatenträger (E)/RavMon.exe: moved to '/var/log/clamav/quarantine/RavMon.exe'




sophomorix-setup-pgldap:

wenn /usr/sbin/linuxmuster-setup da und ausführbar
 - alle mit sed gepatchten dateien nicht anfassen
   - wenn nicht da, selber patchen


paedml 5.0 updates, pakete selber hochladen --> account geben lassen

#268 anleitung ins ticket, wie weitere zeichen getestet werden kann


#155 noch nicht vollstaendig siehe hotline liste mail tshmitt
(doch schon vollständig? warten auf mail von cp)

30.7.10

- Passwort: zulässige Zeichen
            - wie testen? Windows-Schuko,Linux-Schuko,Windows,Linux
  Tut:        @ ! $ % & ? - _ : ; . ,
  Tut nicht:


- sophomorix-workstation -> Schnittstelle zu import-workstation
- sophomorix-virusscan




2.2.26: 

1) welcher Befehl wird von der Schulkonsole abgesetzt beim Passwort ändern:
   /usr/sbin/sophomorix-passwd --nofirstpassupdate --user wie --pass xyz

2) sind die Zeichen in Passwörtern beim Ändern per Schulkonsole 
   eingeschränkt? 
3) welche Sonderzeichen auf internationalen Tastaturen sind als Passwörter 
   funktionsfähig





update auf 2.2.15 majestix:

Updating samba group backupoperators:
   * grp-sid: S-1-5-32-551
Updating samba group replicators:
   * grp-sid: S-1-5-32-552
Deleting groupmap for ntgroup Web Administrators
Unable to resolve group Web Administrators to a SID      
group teachers exists already (10000)
Replacing ldap group dn: cn=teachers,ou=groups,dc=bszleo,dc=de
#### /usr/sbin/sophomorix-useradd started ...                             ####
Stopping Name Service Cache Daemon: nscd.


moven eines Lehrers 2.2.15:

Look in class share: /home/share/teachers
Backup to here: 
   /home/teachers/ri/__dachboden/tausch-2010-07-21_22-48-27/
group attic exists already (10214)
Replacing ldap group dn: cn=attic,ou=groups,dc=bszleo,dc=de
GLOBIGNORE=/; rm -rf /home/teachers/ri/_bereitstellen/bereitstellen-Lehrer
GLOBIGNORE=/; rm -rf /home/teachers/ri/_auszuteilen/auszuteilen-Lehrer
GLOBIGNORE=/; rm -rf /home/teachers/ri/_eingesammelt/eingesammelt-Lehrer
GLOBIGNORE=/; rm -rf /home/teachers/ri/__austeilen/austeilen-Lehrer
qgroup attic exists already (10214)
Replacing ldap group dn: cn=attic,ou=groups,dc=bszleo,dc=de
chown: kann „/home/attic/ri/Desktop“ nicht derefenzieren: Datei oder Verzeichnis nicht gefunden
chown: kann „/home/attic/ri/__dachboden/windows/public_html“ nicht derefenzieren: Datei oder Verzeichnis nicht gefunden
chown: kann „/home/attic/ri/.local“ nicht derefenzieren: Datei oder Verzeichnis nicht gefunden
chown: kann „/home/attic/ri/.kde“ nicht derefenzieren: Datei oder Verzeichnis nicht gefunden
 ****adding attic
group attic exists already (10214)
Replacing ldap group dn: cn=attic,ou=groups,dc=bszleo,dc=de
Replacing ldap account dn: uid=ri,ou=accounts,dc=bszleo,dc=de
   Removing user ri(10867) from all projects 
   * /usr/sbin/smbldap-usermod -G '' ri
   New Group of ri is: attic
   Adding user ri to the projects ...
... done!
   * /usr/sbin/smbldap-usermod -G 'attic' ri
#### /usr/sbin/sophomorix-quota started ...                               ####
Stopping Name Service Cache Daemon: nscd(not running). (warning).
#### Calculating usrquota/mailquota ... (this may take a while)           ####
#### Creating a userlist from options ...                                 ####
INFO: ri is not a sophomorix user, skipping ri ...
INFO: No valid users given

#### Searching for users with changed quota/mailquota...                  ####
#### Setting changed Quota for users in the userlist ...                  ####
#### Removing lock in /var/lib/sophomorix/lock/sophomorix.lock            ####
Starting Name Service Cache Daemon: nscd.
Flushing nscd cache
#### /usr/sbin/sophomorix-quota terminated regularly    








# sophomorix-virusscan:
check if logrotate works for sophomorix-virusscan:
Logfile:       /var/log/clamav/sophomorix-virusscan.log
Clamav:        /var/log/clamav/sophomorix-virusscan.clamav.log


sophomorix.conf convertieren nach ASCI. Schlkonsolen Probleme vermeiden
script das sophomorix.conf neu schreibt


auf linbo2 gibts sophomorix-error wegen quota, wenn 
import_workstations aufgerufen wird


samba unix extensions:
dont descend = /boot, 
http://lists.samba.org/archive/samba-technical/2010-February/069386.html


sophomorix-check geht ab Version 2.2.13 (paedml 5.0.0) davon aus, 
dass die Dateien 
  schueler.txt
  lehrer.txt
  extraschueler.txt
  extrakurse.txt
in einer der folgenden Zeichencodierungen abgespeichert sind:
  ISO 8859-1
  ISO 8859-15 (Standarteinstellung)
  windows1252
  UTF8
Rufen sie nach dem upgrade auf 5.0.0 auf der Konsole 
   sophomorix-check
auf. Falls dabei zu Namensumbenennungen kommt, sollten sie diese anschließend 
beheben, indem Sie sophomorix-check mit einer encoding Option aufrufen
(alle Optionen mit sophomorix-check --help), z.B.:
   sophomorix-check --encoding-students 8859-1
Die liest schueler.txt als ISO 8859-1 ein. Ist/sind die richtigen Optionen 
gefunden, werden sie in /etc/sophomorix/user/sophomorix.conf eingetragen, z.B.:
   $encoding_students="8859-1";
Nun kann sophomorix-check wieder ohne Option aufgerufen werden.

Wenn Sie lehrer.txt auf verschiedene Weise editiert haben (mal mit emacs,
mal vom Windows-Client aus via putty.exe mit emacs, ...), dann kann in 
lehrer.txt ein Misch-Masch von Zeichencodierungen entstehen.

In einem solchen Fall sollten Sie lehrer.txt so editieren, dass die 
betroffenen Sonderzeichen als ASCII eingetragen werden, Das A-Umlaut 
also als Au.






B4   latin1:  '   latin9:  Z






Hilfe von sophomorix-groupadd anpassen. Wie legt man raum an?

lenny:
- passwort wird am windows-client veraendert, es wird aber gemeldet,
  dass loginname nicht richtig oder gross und kleinschreibung nicht ok
- passwort an schulkonsole aendern
  - login schuko klappt ok
  - windows-client ok
  - webmail ok
  - moodle extern tut (bei windows 2x /etc/init.d/bind9 restart notwendig)
sophomorix-check
  - beim ersten start mit no-auto-teach-in werden unids hochgeladen. Warum?



perl literal \xC4\x80
hexadecimal   c4 80

sophomorix-move eines Lehrers:

Replacing ldap group dn: cn=attic,ou=groups,dc=bszleo,dc=de
chown: kann „/home/attic/ls/__dachboden/windows/public_html“ nicht derefenzieren: Datei oder Verzeichnis nicht gefunden
 ****adding attic
group attic exists already (10214)





sophomorix-print:
add --one-per-page to help and manpage


smb.conf: Soll das rein?
[homes]
	max connections = 1


passwort test einbauen: 
      ssh user@localhost  --> yes erforderlich
          --> falsches Passwort: 3x eingeben, 
              dann schluss: return 255 (error)
          --> Richtiges Password: da /bin/false wird user ausgeloggt
              return 1 (return of remote command)

- einlogversuch konsole
- passwort ändern
- einlogversuch konsole


- dump-test-einbauen:
  nicht mehr so wichtig
  nach jeder Datenbankänderung abhängig von option --with-dump
  vor dump ldif erzeugen, nach dump ldif erzeugen 
       -> ldif vergleichen, anzeigen/Fehler wenn Unterschiede


- sophomorix-create-schueler.txt:
  add option with 5th field (6th Field?unid?) to create lehrer.txt



Umcodierung der Scripte in UTF8 so erledigt:

1) 1. Zeile entfernen:
file datei -> iso .......

iconv -f 8859_1 -t utf-8 old_file -o new_file

Done:
   alles in sophomorix-base/scripts
   alles in sophomorix-base/modules
   alles in sophomorix-base/scripts-teacher
   alles in sophomorix-developer/scripts
   alles in sophomorix-developer/modules
   alles in sophomorix-files/scripts
   alles in sophomorix-files/modules
   alles in sophomorix-mediawiki/scripts
   alles in sophomorix-pgldap/scripts
alles in sophomorix-pgldap/modules

sophomorix-base/scripts/sophomorix-print
    \usepackage[latin1]{inputenc} latin1 erstzen mit 
    \usepackage[utf8]{inputenc}
--> OK

sophomorix-developer/scripts/sophomorix-test 
--> OK, tut wieder


Tests:

erzeuge script in iso88591 (Kopie von sophomorix-check)
script > datei ODER print DATEI "äöüß" liefert dasselbe ergebnis 

iso88591:          ä     ö     ü    ß
mit od angucken: \344  \366  \374  \337

                   Ä     Ö     Ü 
                 \304  \326  \334

mit od angucken: \303\244 \303\266 \303\274 \303\237


Kann das utf8 script dieselbe Datei erzeugen wie die iso88591 
ja, mit 

print LOG3 "\344\366\374\237";

In einem utf8 script kann man eine Datei mit einem iso88591-ö befüllen, 
indem man in die Datei \366 printed





Passwörter mit Umlauten geht schief

soll sophomorix-passwd das abfangen? Nur ASCII 7bit zulassen.

---> nach lenny upgrade









sophomorix-useradd --unix-group adlerklasse --examaccount adler


check this out: Object class of a group changes after dump
added with smbldaptools: top,posixGroup,sambaGroupMapping
after dump:              posixGroup,sambaGroupMapping

What does top mean? What is correct?

Wie fragt man encoding system der postgres ab

psql -U ldap ldap

\encoding

psql -l -U ldap

-> nach upgrade latin9
-> neuinstallation utf8





############################################################
lenny64:
dnsdomainname -s liefert unknown host zurück


############################################################
smbldap.conf
############################################################

/usr/share/doc/sm...


schema update

smbldap populate

un dann schauen, welche Optionen drin sein müssen
-> diese dann evtl. nachpflegen




############################################################
slapd.conf
############################################################

slapd.conf: neue Version von Thomas

Modifizieren aus svn:

1) @@tls_comment@@ vor TLS-Einträge
2) $Id$ in eine der ersten Zeilen
3)  


checkpoint      512 30
führt zu fehler bei mir, nicht bei thomas


# testen am bsz
# For the Debian package we use 2MB as default but be sure to update this
# value if you have plenty of RAM
dbconfig set_cachesize 0 2097152 0


# (slappasswd -s villa   -> dann als rootpw)
rootpw {SSHA}kkkkkllll
#
#schreiben mit 
ldappasswd -x -w villa(admipw) -D cn=admin=cd=dc uid=zell,ou=accounts,


# alt
#password-hash {CRYPT}
password-hash {SSHA}

# Protokoll 2 nicht mehr zulassen
allow bind_v2
#allow bind_v2


# 
#lastmod off
lastmod on


# indexe in slapd.conf setzten wegen Performance
# /usr/share/doc/smbldap-tools/README.DEbian.gz




# erzeugt nur last
moduleload pcache
#moduleload pcache


#moduleload bdb
moduleload hdb
# back_hdb paket is bei slapd dabei
# hdb ist stabile Version von bdb, speziell für slapd
# -> ldap neu erzeugen


# CRYPT mit SSHA ersetzen (md5sum)
#
# 1) A) sql befehl für posgres der ein passwort als SSHA abspeichert
#    geht wohl nicht
#    B) mit perl modul SSHA erzeugen und in postgres speichern
#       --> done 
#       dito beim anlegen von ldap account
#       --> synchronisieren des postgres accounts 
# /etc/smbldaptools -> CRYPT mit SSHA ersetzen
#       --> OK
#  TODO: weitere Konfiguration von smbldap.conf
# dann erzeugt sophomorix-passwd SSHA in ldap



# Felder in ldap, die noch rein sollen:
# mailadresse






############################################################
postgres nach ldap, ohne smbldap-tools
probleme:
objectClass: inetOrgPerson,posixAccount,shadowAccount,top,sambaSamAccount

ist im Moment hart reincodiert, sollte aber eigentlich generiert werden
siehe gen-ldif-from-perl
kann man das ldapscheme erweitern?

performance: suffix wird bei jedem account aus slapd.conf geholt




############################################################
sophomorix-imp-expandfromaddress
testen, obs tut
-> script updaten (mindestens anleitung)





############################################################
Next
############################################################


4.0.5 fix:


access section ersetzen:


>schnipp

#######################################################################
#Limits Access:
access to attrs=sambaLMPassword,sambaNTPassword,sambaPwdLastSet,sambaPwdMustChange,sambaAcctFlags,userPassword
       by dn="cn=admin,dc=paedml-linux,dc=lokal" peername.ip=127.0.0.1 write
       by dn="cn=admin,dc=paedml-linux,dc=lokal" ssf=56 write
       by anonymous peername.ip=127.0.0.1 auth
       by anonymous ssf=56 auth
       by self peername.ip=127.0.0.1 write
       by self ssf=56 write
       by * none

access to *
       by dn="cn=admin,dc=paedml-linux,dc=lokal" write
       by * read



in slapd-standalone-template.etch
und                         .lenny drin
im CVS
: probleme:
1. Nach ersetzen von smbldap...template.etch und sophomorix-setup-pgldap
funktioniert das externe Moodle nicht mehr (ldaps)
2. Nach zurückstellen des templtes, sophomorix-setup-pgldap tut
   es immer noch nicht
3. Nach aufruf von dpkg-reconfigure linuxmuster-base

-> also ist nicht klar, ob die Änderungen von 1. zum nichtfunktionieren
   von ldaps geführt haben.

Vermutung: Meldung von update ... in secrets.tdb (aus Erinnerung)
           muss das in sophomorix-setup-pgldap noch gemacht werden?


> schnapp




Option für
./Latex_Musterfile_Passwortlisten.tex


??????????????????????????

schon erledigt?

sophomorix-dump-pg2ldap dumpt
ldap-Feld description falsch:

Bei neuen usern (str)
description: Vor Nach,Vor Nach

bei alten ists ok

Problem: im accounts dump (/var/log/sophomorix...) gibts bei neuen usern 
2 Felder bei description!
????????????????????????????



administratoren Fehlen wenn man sophomorix-test-bunchofusers
nach sophomorix-dump-pg2ldap sind sie wieder da.



Lenny Update:

             auth_passwd
             auth_useradd
             auth_groupadd
             auth_groupdel
             auth_usermove
             auth_killmove
             auth_disable
             auth_enable
             auth_deleteuser_from_all_projects
             auth_adduser_to_her_projects
             auth_adduser_to_project
             auth_deleteuser_from_project
             auth_firstnameupdate
             auth_lastnameupdate
             auth_gecosupdate
             auth_connect
             auth_disconnect

in sophomorix-pgldap.pm anpassen

- Net::LDAP wird von allen scripten schon geladen
- sophomorix-pgldap.pm prüft Verbindungen mit Net::LDAP-> new
- sophomorix-pgldap.pm:
  check_connections postgres UND ldap verbindungen prüfen
  auth_connect : Verbindung mit ldap via Net::LDAP
  auth_disconnect : Verbindung trennen via Net::LDAP

create_user_db_entry ruft auch auth_useradd auf
dann fehlt aber die Gruppe um den user anzulegen:

-> Erster Schritt: Gruppe mit Net::LDAP anlegen
   create_class_db_entry ruft auth_groupadd auf

   In auth_groupadd:
    smbldap-groupadd-Befehle
      A) bzw. Quickfix: nscd restart einbauen (restarten die nscd restart scripte auch auf lenny nscd?)
         tut Sophomorix-Base.pm  nscd_flush_cache?
      B) Quickfix: Zeitverzögerung, 
      C) Fix: ersetzen mit Net::LDAP zeugs
         #1 in sophomorix-test gruppenanlegen testen
         #2 gruppe schon anlegen, funzt dann sophomrix-test?
         #3 tuts auch beim anlegen der Gruppe kurz vor dem Test


12:03/0 majestix ~ # smbldap-groupshow m2kk3t
dn: cn=m2kk3t,ou=groups,dc=bszleo,dc=de
objectClass: posixGroup,sambaGroupMapping
gidNumber: 10285
cn: m2kk3t
memberUid: bz,thuermjo,schoelde,zeugan,zoderde,kratscde,schneito3,herrmasi,zerwecsa,recherse,bunkru,altsi1,wiesmuti,rodrigso,schweist,pabstac,mokoscto,schomesa,reinhapa,lorbacka,engenhpa,foellfe,muelleda1,boehmma,deckerma,eckertpa,mohran,heilemka,petzoler,ruecklka,jon,kj,bck
sambaSID: S-1-5-21-3993262446-3865354187-2627030318-21571
sambaGroupType: 2
displayName: m2kk3t
12:03/0 majestix ~ # 


Wie kommen die user da rein? funzt smbldap useradd, wenn leere gruppe existiert


27.1.10: Hat ohne änderung funktioniert
   Warum? -> Wirt hat mehr RAM 8GB statt 2GB
             Gast: ???
          -> Pakete auf lenny aktualisiert
          -> sonst nix verändert


  



Bennennung: Workstation zweideutig (sollte Computer bzw ExamAccount heissen)

fetchworkstations_from_school -> holt alle accounts mit /home/workstations


Bug: 140 email account dumpen nach ldap

Bug: ??? ldapmodify statt smbldap-useradd/usermod

so vorgehen:
   in sophomorix-dump-pg2ldap eine Option einbauen, die neue Funktion besitzt:
   sophomorix-dump-pg2ldap --user login
   die 
      -jeden account:
         Computer
         ExamAccount
         Lehrer
         Schüler
         Admins (später)
      - exakt so im ldap generiert, wie es der dump machen würde
        (auch gleiche Reihenfolge der Einträge, ...)
   dieselbe Funktion wird beim Anlegen der user aufgerufen

   Stellt man fest, dass der ldap etwas andern generiert werden soll (Zusatzfeld), 
     geht man so vor
     1. Gesamt dump so abändern, dass es passt ->  ldif dump sichern
     2. Einzel dump so abändern dass es zusammen passt



Wenn ein user gelöscht wird, folgendes zusätzlich machen.

quota.txt: sonderquota auskommentieren 
(mit Kommentarzeile davor: # sophomorix-kill has disabled the following line (user killed))
dito mailquota.txt, /etc/aliases


ldap rupp 21.7.09

Mail 21.7.09 


Hallo Herr Beck,

als ich eben den Quellcode Ihres Programms "sophomorix-check" (v 1.138 2009-05-19 10:15:16) analysierte, fiel mir Zeile 1805 ins Auge:

   } elsif ($strichpunkt_anzahl==5 && $filename eq $schueler_to_check_dateien[1] ){

Kann es sein, dass $strichpunkt_anzahl vielmehr $number sein müsste?

   } elsif ($number==5 && $filename eq $schueler_to_check_dateien[1] ){



Mail account leichen im ldap
-> nachstellen, wieso gibts die Leichen überhaupt



Unknown Error 1 in errors.lang". 
Unknown Error 9 in errors.lang". 
 -> siehe Mail 17.9.09 10.53
Weiter:
knöpfe in der Schulkonsole drücken, welche Befehle werden aufgerufen




/etc/ldap/schema:

1) core.schema -> mail  -> wenn nicht single value dasteht, 

benuzt im ein mailschema? 


mail wir geleitet 


oder 2) eigenes Schema für mail

ldap alias attribut
courier
sendmail
...    alle haben eigenes schema,


postfix schema, www.postfix-buch.com/downloads.php








ubuntu Paket:

Probleme:
A) postgres 8.3 verlangt encoding system UTF8 statt LATIN9
B) NEU: einlesen von slapd.conf wie in http://wiki.ubuntuusers.de/OpenLDAP beschrieben
   slaptest führt zu Fehlern bei:
      schemacheck on
      checkpoint 512 30
      dbcachesize 1000000

C) user aus ldap sind nicht sichtbar (id ...)
D) wenn sophomorix-setup-pgldap aufgerufen wird wird postgres 
   von 7.4 auf 8.1 upgegraded. Mist



1)
2) ldap wird nicht mit usern gefüllt
   Testen:
     lsof -a -i TCP:389 -c slapd

     liefert Ergebnis ...

3) root@ubuntu904server:~# nmap localhost | grep ldap
   Warning: Hostname localhost resolves to 2 IPs. Using 127.0.0.1.
   389/tcp  open  ldap

4) slappasswd wird nicht genutzt

5) Verzeichnis /etc/ldap/slapd.d sichern und leer neu anlegen
   chown -R openldap:openldap /etc/ldap/slapd.d
   slaptest -f slapd.conf -F slapd.d
   ...> liefert 3 Fehler, Zeilen auskommentiert
    schemacheck on


6) folgende ldif laden mit: ldapadd -x -h localhost -W -D cn=admin,dc=linuxmuster,dc=de -f base.ldif

dn:dc=linuxmuster,dc=de
objectClass: dcObject
objectClass: organization
o: linuxmuster
dc: linuxmuster

dn:cn=admin,dc=linuxmuster,dc=de
objectClass: organizationalRole
cn: admin


7) Connection with luma:
Anonym: 
    server:389, keine Verschlüsselung
    Anonym
    Anonym binden
    DNs vom server nutzen

Simple:
    server:389

    Authentifizierung:
    simple
    Bind as:         cn=admin,dc=linuxmuster,dc=de
    Passwort:        *********                       (from /etc/ldap.secret)

Was ist denn der Unterschied zwischen anonymous and simple?




8) ldapsearch -x  (tut nur, wenn slapd läuft)

to vm's:

1) root Passwort: passwd
2) vmware tools
3) sources.list:
   deb http://172.16.61.1/debian/dists/jaunty/main/binary-i386 ./

$HOME des schulkonsole root scheint / zu sein
-> eigenes home? /root als home?


user teilweise anlegen (Datum passt nicht in postgres)
dann die löschfunkton testen. Sollte weitermachen und möglichst nicht abbrechen

Paket-Abhängigkeiten (latex):

Alt:                   Neu (ubuntu 904 server, lenny)
tetex-base            
tetex-bin
tetex-extra




############################################################
Erledigt
############################################################
projektanlegen, ... gruppenzugehörigkeit einer person
nscd sollte noch geflushed werden -> checken
-> getestet, nscd wird restartet


Bei ersten lauf von sophomorix-test:
chownen der vom user erzeugten Dateien
   chown: fehlender Operand nach ".attic"
   chown: fehlender Operand nach ".7c"
   usw.

   Lösung: bei find ... | xargs ...

   wird der Befehl hinter xargs 1x ausgeführt, wenn nix gefunden wird:
   --> option --no-run-if-empty behebt das















Feature Request: 
########################
user disablen für eine bestimmte Zeit.


> ich wünsche mir aber immer noch ein einfach zu bedienendes feature um schüler für eine bestimmte zeit aus dem netz auszuschliessen.
>
> sophomorix-user -F ist ja schon mal ein guter anfang. das reaktivieren ist allerdings etwas schwieriger.

Weshalb ist denn da reaktivieren schwieriger?

geht denn sophomorix-user -A nicht?


>
>
> wie wäre denn sowas wie:
>
> sophomorix-user -Z user TIME (DD-MM-YYYY oder +90days)
>
> in der zeit sollte sich der user nicht einloggen dürfen, aber eine ldap anfrage sollte positiv sein (wir benutzen z.b. ldap über unser moodle von belwue aus).
>
Nicht einloggen ist ja das vorgesehene.
Leider weiss ich nicht wie das mit moodle und belwue geht.
Eigentlich sollte das mit der ldap Anfrage gehen, es wird ja lediglich der login disabled.


Als workaround könnte man das automatische wiederaktivieren mit dem Befehl 'at' machen.

Gruß, Rüdiger Beck
> spitzenklasse wäre auch eine integration in der schulkonsole für den administrator. sie könnte vielleicht so aussehen.
>
>
>
> user suspendieren:
>
> [       ] name  [   ] tage    [X] dauerhaft
>
> [user jetzt suspendieren]
>
> -------------------------------------------
> suspendierten user        restzeit in tagen
>
> xxxxxxxxxxxxxxx      [ ]           x
> yyyyyyyyyyyyyyy      [ ]           y
> ...
>
> [markierte user sofort reaktivieren] 


IDEE: -S suspend --startdate 01-01-2009 --stopdate 03-04-2010 
  -> status S
  - wenn stopdate mit + beginnt, dann zum startdate hinzuzählen 
cronjob schaut , welcher user ein S als status hat
--> neues Feld in der Datenbank:
ScheduledActivation

wenn die zeit gekommen ist, dann reaktivieren



   ScheduledDectivation (gestern, heute, in zukunft)
      - wenn startdate gestern, heute oder früher: sofort deaktvieren
      - ansonst in Zukunft per cronjob deaktivieren lassen
   ScheduledActivation
      - per cronjob










SophomorixBase, Zeile 1113 (Dateiversion 1.295):

if ($owner eq "$login") {

führt zu undefined Value beim Versetzen.
Konnte nicht nachvollzogen werden
Liegt vielleicht daran, dass der user eine 'komische datei' 
(Leerzeichen, Schlange, ...) in ein Tauschveruzeichnis gestellt hatte und 
deshalb nicht der owner ermittelt werden kann.


lehrer.txt:

In der Spalte wo sonst "erstpw" zu finden ist, steht "---".
Hast du eine Erklärung?

mmba usw checken. Was passiert mit frozen accounts?
- Mailempfang
- wie reagiert restet-user, ....wird mail gelöscht, ....
- Mailempfang bei frozen abstellen?


einstellungen erscheinungsbild desktopeffekte



Dist-Upgrade auf ubuntu server 8.04: # 89 (Eigenes Ticket # 90)

postgresql: 

Abhängigkeiten:
etch:           postgresql-8.1(>=8.1), postgresql(>=7.4.7)
ubuntu 9.0.4:    

Sichern von notwendigen Dateien:

   OK: sophomorix-support --nozip --path /path/to/dir
   OK: --prepare-dist-upgrade
         like above, saves to /var/upgrade/linuxmuster/<paketname>
         where <paketname> is sophomorix2
TODO:
--do-dist-upgrade



alternative Pfade angeben:
/etc/smb.conf::/etc/samba/smb.conf

- falls beide existieren -> eine muss gelöscht werden
- Dateiliste mitsichern (da sind die Konfigs gebackuped)
- zum Wiederherstellen die Dateiliste des neuen Pakets nutzen
- beim Wiederherstellen:
   gesicherte, alte Liste nehmen:
         smb.conf wurde nach /etc/smb.conf gesichert
   neue Liste nehmen: Datei smb.conf, wo muss die hin?
         smb.conf muss nach /etc/samba.conf 



Hotline:

Befehl, um integrität von paketen zu zeigen. Am besten mit diff

debsums -a paketname



sophomorix-vampire erweitern, dass man von 3.0 auf 3.0 'updaten' kann
evtl. einzelne server nur holte: hole rembo server, hole linbo server

- Als Einstieg ins xenisieren,kvmisieren  gedacht 


kvm:

virtmanager für kvm von redhead
kann usb



Bug 48:
schulkonsole wird modifiziert

Bug ???:

# 64: Links in die Tausch-Verzeichnisse.

tun nicht immer siehe bck. 

/usr/bin/sophomorix-teacher --teacher bz --add m2kk3t 
works on console for bck




  ? - gilt das nur bei bck
  ? - geht net groupmap list auf windows client?



Analyse script erzeugen:
   - sophomorix-repair --check-share-links user
   - sophomorix-repair --check-all-share-links
   - user und gruppen listen
   - mit id deren gruppen zugehörigkeiten testen
   - existieren die Links dazu in _tauschen
Reperatur script erzeugen.


Wish:

show frozen, permanent, ... user accounts

...
username   frozen     (F)
username   permanent  (P)
..


Bug:

sophomorix-groupdel --delete-all-empty-classes


- sobald eine klasse gefunden wird, die nicht gelÃ¶scht werden kann endet das Program 
  wenn man 

    --remove-teachers

  anhÃ¤ngt, dann werden aber mehr klassen gelÃ¶scht, als ohne diese
  option angezeigt wird.


Bug:

select * from groups_users where gidnumber=10000;

liefert mehrere administratoren in teachers (10000)

SQL-Befehl um mehfache Einträge in groups_users herauszumachen

siehe:
select * from  groups_users ;



sophomorix-setup-pgldap --new-database bricht ab.



ldap forschung:

dumpd ldif:
slapcat -l dump.ldif 

smbldap-groupshow teachers zeigt nicht alle lehrer als mitglieder
in klassengruppen sind nur die lehrer zu sehen

Vermutung: smbldap-tools machen das richtig, aber das dump-script machts falsch

--> korrigiert
 




linbo:

hwinfo (debian-Paket) um anzeigen 


trac: lml.linuxmuster.net/trac (Frank)
      Doku zu pykota

neu: lml.support-netz.de/trac/
     pkg.support-netz.de
     (Nürnberg, Hetzner)

     mailingliste testing, leute melden sich an, die testen wollen
     tickets für die tests anlegbar

     build.lml.support.netz.de
        - um pakete zu bauen
        - wird NICHT gebackupt
        - distri: etch 32 bit 

     einloggen per ssh nur mit key
     private key auf stick mitnehmen
     mit truecrypt verschlÃ¼sseln

          


nächste Distri 8.04 LTS
        postgres 8.3
        slapd 2.5
        ...


        ??? Idee für upgrade:
        - sollte auch tun, wenn 



Extrakurse:

in Schulkonsole sichtbar in 
   Einstellungen -> Klassen -> sichtbar/unsichtbar schaltbar





octal dumper:

Bugfix: sophomorix-quota


grep 'string in line' schueler.txt > log1
grep 'string in line' schueler.txt | od -c > log1


wobei 'string in linie' die Zeile des problematischen 
Schülers heraussuchen sollte.

Danach die Dateien log1 und log2 als E-Mail Anhang zusenden


sophomorix-endofyear:

- Alle Klassentauschverzeichnisse leeren.
  (Mit bz2 backup oder ohne)
- Den Dachboden der SchÃ¼ler leeren.
  (geht automatisch)
- Austeilen, Einsammeln, Vorlagen der SchÃ¼ler leeren.
- Nach dem Versetzen nicht mehr vorhandene Klassen (ohne SchÃ¼ler als Mitglieder) 
  lÃ¶schen.
  -> sophomorix-groupdel --delete-all-empty-classes
- Alle Klassen bei den Lehrern automatisch austragen.
  (sollte jeder Lehrer selber machen)



PasswortÃ¤nderung serverseitig fÃ¼r workstations nicht mehr zulassen.

Mit
# smbldap-usermod -A0 -B0 host$
werden die EintrÃ¤ge korrekterweise so gesetzt:
sambaPwdCanChange: 2147483647
sambaPwdMustChange: 2147483647
Damit wird sambaseitig die PasswortÃ¤nderungen unterbunden.
Danach hatte ich das Problem nicht mehr. 


wenn man extraschÃ¼ler anlegt (klasse sekretariat), dann kommt Fehler: cannot determine type of sekretariat.


paket update auf etch

sophomorix-quota steigt nun mit Fehler aus, wenn in
/etc/sophomorix/user/sophomorix.conf $use_quota auf "no" gesetzt ist.
Ich lasse nun import_workstations die Quotierung nur noch setzen, wenn
$use_quota="yes" ist. Ist gefixt in linuxmuster-base 1.4.16. 


index erzeugung raus??



# 190 - . _ in loginnamen

immutable bit testen


new:
sophomorix-repair --repairhome-from-file /path/to/file

nutzt eigene Datei statt repairhome.students, teacher, ...



link zu code suchmaschine von Thomas


pyquota:

in die konfigurationsdatei rein, ob user fÃ¼r druckquota mit pykota
eingestellt werden sollen, Wenn script dann da ist, dann beim anlegen ausfÃ¼hren

verzeichnisse erstellen
/etc/sophomorix/scripts/postadd
/etc/sophomorix/scripts/postkill
                            move
                            ...

in diesen Verzeichnissen nach ausfÃ¼hrbaren scripten suchen und dann
der reihenfolge nach ausfÃ¼hren:

script user group homedir

README in diesen Verzeichnissen:

# Do not change this file
# it will be automatically updated
#
# Alle executable files in this directory
# will be run with the following parameters
# 
# scriptname user group home
#
# where 
#  user   is the linux username
#  group  is the primary group aof the user
#  home   is the homedir of the user



sophomorix-kill --killuser
-> exit at once if user is a workstation, ...


Linux-client:

wenn sich schueler anmeldet und der Rechner nicht heruntergefahren wird,
dann kann sich der zweite nicht mehr anlegen, da das $HOME vom ersten noch gemounted ist.

Bei Lehrer tuts. kubuntu 7.04, kdm

Dateibenennungen mit sonderzeichen:
mit win angelegte Dateien mit Umlaute koennen unter linux nicht 
geoeffnet werden



Todo:

Fehler  1 soll auch in der Datei stehen: siehe /var/log/sophomorix/command.log
Fehler 64 wen den sie sich an ihren Netzwerkberater

Retun values anpassen:

0            kein Fehler
1 bis 63     adminfehler  (schuko: interner Fehler)
64 bis 127   schukofehler (schuko: userfehler)

log_script_exit: In der zweiten Option steht die Fehlernummer:

return 0 bedeutet: kein Fehler, Ausgabe ins log: Option 1
                   (Option 1 sollte in englisch sein)
return 1 bedeutet: Fehler OHNE Eintrag in errors.lang
                   Ausgabe ins log: Option 1
                   (Option 1 sollte in englisch sein)
AIKE??: Meldung: bitte sehen sie in /var/log/sophomorix/command.log nach

return 2- 63 bedeutet:
                   - Option 1 wird NICHT BEACHTET
                   - Fehlermeldung wird in errors.lang gesucht
                   - Der Fehler wird von der Schuko als adminfehler 
                     betrachtet:
                       als user:  interner Fehler
                       als admin: Fehlermeldung wie in errors.lang gezeigt

AIKE?? sollte 64 wie 1 behandelt werden? siehe command.log

return 65- 127 bedeutet:
                   - Option 1 wird NICHT BEACHTET
                   - Fehlermeldung wird in errors.lang gesucht
                   - Der Fehler wird von der Schuko als userfehler 
                     betrachtet:
                       als user und admin: 
                           Fehlermeldung wie in errors.lang gezeigt

if ($rc & 0x40) { print "userfehler\n"; }
if ($rc & 0x80) { print "schulkonsolenfehler\n"; })



Pre-depends fÃ¼r libnss-ldap? und andere?


Return:  0 alles OK
         1 zurecht gelockt

Modul bereitstellen, das eine Funktion beinhaltet
, die bei abfrage den schulkonsolenstring zurÃ¼ckgibt

$string = &fetch_return_string(42);




Passwort checken

\U
\Q
\E beendet



???????????????

aike schulkonsole abschalten

linbo testen in wlan/ipcop


/etc/linuxmuster/workstations:

Idee: Textfile bearbeiten und Schulkonsole zusammenbringen:
Die # Zeile wird als Kommentar in der Schulkonsole angezeigt
...


neues script:
sophomorix-workstation --pdf 
   Gibt latex-formatierte Liste aus.

/etc/sophomorix/sophomorix.conf

    # where to print common data for admins
    $admins_printout_dir="/root";

    dahinein werden geprintet:
   
    ../workstations/$date_workstations.pdf
    ../users/$date_workstations.pdf




Saving the Real Name of a class (Konfigurable, needs a field in the database?)
i.e.    m1kb2t  --> M1KB2T
        wg111   --> WG11/1S	

Saving the Real Name of a student incl. Ã¶Ã¤Ã¼Ã in one field
for netexamplix and others


sophomorix-move:
chown Fehler auf Gruppe hat keine Dateien, schlÃ¤gt fehl: > unschÃ¶n


Tests fÃ¼r unid schreiben:
- kurz vor dem entfernen der user:

  - doppelte unid : nix darf sich in der Datenbank Ã¤ndern
  - unid Ã¤ndert sich bei gleichem identifier


Differenzen manpage/--help anpassen (mail von der Hotline)


sophomorix-project --reset-project name
(dangerous, when teacher is a member of this project!!!)


hidden option in sophomorix.conf, um
 - Benutzername mit vorname.nachname erlauben.
   Was passiert, wenn schon vorhanden (mendyk meldet sich) 


perl debugger mit history:

aptitude install libterm-readline-perl-perl


Perl Debugger:
   Variable ausgeben: p $var
   Hash ausgeben:  p x\%hash
   Liste ausgeben:  p x\@list
   Next line: n    (arbeitet Zeile ab, auch wenn Funktion)
   Single step: s  (geht in Funktion rein)

sophomorix-mediawiki in ein eigenes paket packen



sophomorix-mail Zeile 169: fetchdata_from_account
sollte $home,$type abfragen statt $group

sophomorix-kill -u login:

gibt fehler auf majestix: exit via .. in ....

######################################
ACL: (filesystem ACLs)
#####################################
Where ACL's can help:

1) pgmadmin should be allowed to look into shares of classes/projects,...
   (alternative/not so good: add pgmadmin to the projects)
 
2) shares of a project should be open only for members


check if latex can be made uninteruptible with option.
(checked, but no solution found)

Feature request: Projekte umbenennen
KÃ¶nnte so gelÃ¶st werden
  1) auspielen der Daten eines Projekts in Textdatei
  2) anlegen desselben Projekts mit neuem Namen
  3) Daten in Tausch, ... was noch kopieren/moven
  4) altes Projekt lÃ¶schen 

sophomorix-teacher --teacher galli --add 11a
liefert fehler beim start des nscd:
Starting Name Service Cache Daemon: nscd/etc/init.d/nscd: line 36: start-stop-daemon: command not found


sophomorix-mail nochmal checken

in sophomorix-test einbauen


bei anderen scriten startet der nscd problemlos




sophomorix-vampire:
add nscd stop commands alter sophomorix script calls


sophomorix-move:
  chown: zu wenige Argumente
  ,,chown --help" gibt weitere Informationen.
wenn der user keine Dateien hat


loginname umbenennen noch anschauen.
horde updaten.
mail-versandadressen updaten???

Bug auf schulserver bei sophomorix-dump-pg2ldap:
slapadd: dn="sambaDomainName=bszleo,dc=bszleo,dc=de" (line=26): (64) value of naming attribute 'sambaDomainName' is not present in entry
loading dump ...


zu check_connection hinzunehmen, ob debian version ermittelt werden kann,
wenn nicht abbrechen


PrÃ¼fen, ob manpages nach Postscript konvertiert werden kann
(und dann pdf) 


sophomorix-vampire: bei 
sophomorix-vampire --sync-homes wird // angezeigt bei chown 


sophomorix-mail --showforward
  - zeigt die .forward-Dateien aller Lehrer/user an
    (evtl. zusÃ¤tzliche forwards in cyrus/horde???)
    Beispiel in sophomorix-minitest
    +----------+---------------   
    + user     + .forward
    +----------+---------------
      bz         \bz
          bz     bz@web.de
    +----------+---------------


sophomorix-class -i -c name sollte
Klassendaten anzeigen (wer ist seit wann mitglied, status, etc...)
     vgl. mit sophomorix-project

beim lÃ¶schen von RÃ¤umen  wurde evtl. nicht in der Tabelle 
class_details gelÃ¶scht
muss evtl. nachgeholt werden



############################################################
Migration to etch
############################################################

Nicht standardmÃ¤Ãig etch:

moodle ist 1.9 etch wÃ¤re 1.6
mondi und mindi

script zum update von 7.4 auf 8.1
gibts script in postgres 8.1


Test:
 - 8.1 zusÃ¤tzlich installiert:

aptitude install postgresql-8.1

das installiert:
    postgresql-client-8.1 postgresql-8.1


port 7.4: 5432
port 8.1: 5433

psql -U ldap ldap              : geht auf 7.4.17
psql -p 5432 -U ldap ldap      : geht auf 7.4.17




Upgrade the debian way:

1)  pg_dropcluster 8.1 main --stop
2)  pg_upgradecluster 7.4 main
3)  pg_dropcluster 7.4 main   (um den alten cluster zu entfernen)


danach geht 
   psql -U ldap ldap 
auf 8.1

port von 8.1 ist: 5432
(auf port 5433 lÃ¤uft keine postgres mehr)

Ein Paket zum update packen:
 - Versionsnummer 2.0.0-1
 - In debian/control 
   Pre-Depends: postgresql (>=8.1.9)
 





Bem: ext3 hat neue Features auf etch. sarge kann kein ext3 von etch checken



nscd ist beim standard etch dabei
   - Zusatzoption 'status' in /etc/init.d/nscd status

nscd muss der mit kill -9 abgeschossen werden?


To check:

/usr/bin/newaliases is missing ??? REplace Error with warning



What had to be done:

- packege dependency to odbcinst1 had to be removed
- path to config files postgresql had changed
  /etc/postgres  --> /etc/postgres/7.4/main
- name of initscript postgres had changed
  /etc/init.d/postgresql  /etc/init.d/postgresql
- smbldap-passwd had different output when askin user to 
  type password
- smbldap-useradd:
  Option -c setzt nicht mehr das Feld 'description'
  smbldap-usermod -c tuts.




############################################################
Problems
############################################################


cups-pdf: not necessary for Administrator (not a user account)

Other Questions
- problems: a teacher can fill the HD space easily with 
  handing out lots of data



############################################################
KNOWN BUGS
############################################################
BUG: a user in dachboden is reactivated by a similar
     (=must be identical) new user

BUG: 
ps2pdf cuts away the footer when sophomorix-print is running




############################################################
DOKUMENTATION To do
############################################################

dokumentation:
   * grafik workflow aktualisieren
   * write how to test sophomorix
      - sophomorix2
      - sophomorix-doc-html
      - perldoc Sophomorix::SophpmorixAPI
   * logging   


############################################################
PACKAGING for DEBIAN To do
############################################################

packaging:
   - Makefile creates directories with correct permissions, 
     how can I package this directories with its permissions?
   - sophomorix-vampire version x.x braucht sophomorix2 1.2.2
     (das steht in den abhÃ¤ngigkeiten), falls es installiert werden soll (optional)
     andersherum braucht sophomorix-vampire dieselbe Versionsnummer von sophomorix2 
     wie macht man das?
   - optionen in postinst-scripten upgrade)



############################################################
host of the build-host
############################################################





############################################################
MAKING a Package on build-host make lenny make ubuntu
############################################################



Packaging:
-----------



Testing:
----------

1. install sophomorix-developer

2. Tests
   A) sophomorix-test
   B) sophomorix-test-bunchofusers --add
   C) sophomorix-test-bunchofusers --wsadd

   sophomorix-repair --permissions
   sophomorix-repair --repairhome
 
   D) sophomorix-test-bunchofusers --handout
   E) sophomorix-test-bunchofusers --collect
   F) sophomorix-test-bunchofusers --handoutcopy

3. No test is allowed to throw an error.



############################################################
nfs server
############################################################

share the sophomorix sourcecode on a virtual guest

Einloggen via root@lenny

In /etc/hosts:

192.168.122.60  lenny



Server(host):

1. aptitude install nfs-kernel-server
2. edit /etc/exports:
   /home/bz/cvs 192.168.122.0/255.255.255.0(ro,async)
3. exportfs -ra


Client(guest):
1. mkdir /mnt/cvs
2. edit /etc/fstab:
   # for adler
   10.1.23.10:/home/bz/cvs   /mnt/cvs-adler   nfs   ro   0   0
   # for dell D830
   10.1.23.7:/home/bz/cvs   /mnt/cvs-dell   nfs   ro   0   0
   # for thinkpad x61s
   10.1.23.4:/home/bz/cvs   /mnt/cvs-thinkpad   nfs   ro   0   0



############################################################
kvm vorbereiten, pakete herunterladen
############################################################


1. aptitude dist-upgrade

2. aptitude install less emacs cvs lsb-release diff make 
   aptitude install openssh-server libterm-readline-perl-perl 
   aptitude install perl-doc nfs-kernel-server



3. aptitude -d install sophomorix2 
   (lädt alle Pakete herunter, ohne zu installieren)

image erstellen:
1. kvm gast herunterfahren
2. sudo cp /var/lib/libvirt/images/lenny64.img /home/bz/kvm-backups/lenny64.img
   (lenny64.img ist verlinkt auf /home/root/kvm)


kvm-host wiederherstellen
sudo cp /home/bz/kvm-backups/lenny64.img /var/lib/libvirt/images/lenny64.img


ls -alh /home/bz/kvm-backups zeigt immer 4GB (Festplattengröße)

??? Wie kann man benutzten Platz anzeigen lassen?


Image zippen mit bzip2


Clonen auf anderen Rechner:

dort ein Rechner anlegen:
- alles gleich
- mac adresse gleich einstellen
- /etc/fstab (für jeden Rechner einen Eintrag ins image)


############################################################
Repositories
############################################################

paedML 3:
http://lml.support-netz.de/


Request Tracker
https://lml.support-netz.de/rt/

Pakete:
http://pkg.lml.support-netz.de/

lml30-updates  stable updates  
lml30-testing  testpakete
lml30-unstable testpakete, die es vielleicht nach updates 
lml30-sources  sources der updates

incoming directory 

lml30-linbotesting



stable   testing
lml40  stable   testing


############################################################
MODIFY directries when user is created or repaired
############################################################

1. To make it possible to rename such a dir:
   add variables in sophomorix-lang.de, ...
2. SophomorixBase has a function provide user files:
     A) decide if teacher or student
     B) create a setup_verzeichnis entry
3. create an entry in repair.directories with permissions, 
   owners and groupowners
4. To make sophomorix-repair replce the placeholders
   in repair.directories:
   - insert replacement string in function repair_directories

(If unsure where to find tho correct place in the scripts, 
 grep for 'handout')



############################################################
SCRIPTS To do
############################################################

sophomorix-repair (seems OK so far)
   

sophomorix-quota
   * option --sum still missing
   - check if quota is really set (how?, grep through 'quota user' ?)
     do this as cronjob. check if quota in the os is the same as in the 
     database
   - find users without quota, report them (cron)


sophomorix-teach-in (seems OK so far)


sophomorix-check
   - what about the shell (/bin/bash) when updating from old files?
   - what about the quota  when updating from old files?
       lehrer.txt: automatically used, when copied
       quota.txt:  automatically used, when copied
       projects:   did not exist, ok
       classes:    schulinfo.txt should be copied/used to class_db
             --> check this
   - add more auto-teach-in
      - exchange of firstname and lastname should be detected automatically
   * filter out users in schueler.txt that have groupname "lehrer" or "teacher"
     for security reasons
   - add use of field 6, upload Field 6 Data automatically into database
      - add entry for every user in user_db: "Department"
      - for every department create entry in the postgres database
      department_ contains:
         - Name of department i.e. "Hauptschule"
         - Name String, i.e. "HS Sydney", which is used by printing things.
         - Mail suffix, i.e "hs-sydney.de" -> user@hs-sydney.de
         - short name, i.e. "hss"
         - automatisch: SchÃ¼lerzahl, Klassenzahl ?????? oder besser dynamisch
         - ....
   - Format report.office with latex          


sophomorix-add


sophomorix-move
   - move Data from share into home, even if 'hidden' in another owners directory


sophomorix-kill


sophomorix-user 
   - wenn user is activated, then add her automatically in her ExitAdminClass, 
     if she is in dachboden 
       now, you still have to do -check and -move
     or in the class specified by  -c class option
   - Changing a state of a user (make Permanent, Killable, ...)
     by using function create_userlist, i.e. make all pupils killable
   - option --move moves a pupil at once in the new class 
     i.e. (calls sophomorix-move -u user)
   - user with status U,E must not be activated?
   - option --activatable (or -i -D -T shows info about Disabled or Tolerated users)
   - when reactivating a user, set a date in the future to keep her longer acctive 
     (optional parameter, configurable)
   - option --clean-account: remove all data from the account, without removing
     the account, password, ... itself (useful for guest accounts)
   - option --newest shows/modifies users added on the latest day/latest run
   - group display: separate primary groups from secondary (more logical) or not 
                    (like id -nG user) 

   - create lists of users (move to sophomorix-print)
       - one or more classes, projects, ... or the whole school
       - csv,xls,pdf, ....


sophomorix-split
   - sophomorix-split options: 
        split randomly in 2,3 parts
        split a class into projects(is this necessary?)


sophomorix-passwd
   - generate login-cards with changed passwords automatically
     (passwd_change.pdf)
   - make this an option to sophomorix-user


sophomorix-print
   - print subclass on login-card?
   - option --project to print login cards for members of projects
   - what about projects, show project membership?
   - put school-logo on login-card, watermark, ...
   - generate a onepage-printout for teachers (help, mail, webmin-login, ...)
   - root can allow teachers to move his students in a special permanent class
     i.e. to allow some of its students to participate in a wiki permanently
     admin should be able to define an 'veteran project', i.e. 
     m4kb2t --> mkb-veterans
   - allow other than [a-z0-9_] in strings that is used for latex


sophomorix-project
   - ML 3.0: allow open projects only (--join)
   - add status stuff/lifetime stuff to projects
      P= Permanent, will not be automatically removed
      ... see drawing in doku
      when a project is disabled:
       - no data exchange
       - no database access, ...
       - mail to project teacher
       - delete after xxx days (cron-job)
   - when killing a project: 
       - delete line
       - delete exchange dir
       - delete links from users to exchange dir
       - move data back to homedir of user?

   - allow teachers to add a project (if no addquota is involved)
     - (maximum of Projects is configurable for each teacher: standard 30)
     - standard final date: one year from now or schoolyears end (if configured)
     - maximum length is 3 years
     - extension of length is possible
     - deleten of a project is only possible as the creator (-> field in database) 

   - allow admin:
     - projects with additional quota
     - permanent projects
     - delete a project at once
     - push a project into the deletion cycle (send mail,deactivate,autom. deletion)
     

sophomorix-class
   - count users in classes, display with -i
     show total of clases with users / without users


sophomorix-test
   - include testing the log file.
      - log in different file while testing
      - check this file for correctness
      - remove this file


sophomorix-test-bunchofusers
   - option --exam (distribute, collect, exams)
   - option --split (split a class)
   - option --project (create a project, check members, exam, ...)
   - choose uncommon loginnames/groupnames so that it can be 
     run on a working system
   - interrupt *-bunchofusers before doing anything 
     when loginnames that are to be created are present already

sophomorix-vampire:
   * create config-files (perl-syntax):
       - list of files with abs-path to get them from old server
       - file with /path/on/old/server::/path/on/new/server
         sync them automatically

       - /usr/local/samba/progs  -> /home/samba/progs
       - /usr/local/samba/cds    -> /home/samba/cds
       - /usr/local/httpdocs     -> /var/www

   * backup /etc to /etc/sophomorix-vampire
   * backup old login scripts

     neuer server mit laufendem cyrus-server, dann aus /var/spool/mail/user
     mit cyrdeliver zuschicken

     siehe: http://cyrusimap.web.cmu.edu/twiki/bin/view/Cyrus/MboxCyrusMigration

     von cyrus auf cyrus: imapsync

   - generate a log file what went wrong


   - strategie for rembo:

     garbage that should not be taken to a new system

     images:
     /var/lib/myshn  /usr/local/rembo/files/global/myshn/groups
                                                         hosts
                                                         users
                                                         hdimages
                                                         nicht die patch.*
                                                         Konfigurationsdateien
                                                         Nicht: bin
     rembo beenden
     /var/lib/rembo  /usr/local/rembo/files/shared

     rembo -chkshared zeigt die zu entfernenden an     
     
     konfigurationsdaten:
     rembo.conf
     /etc/myshn ist link

    Projektgruppen nach Anleitung T.Schnitt Ã¼bernehmen


   
sophomorix-mail


sophomorix-teacher
   - distribute _Collect to one pupil
   - backups after rsync are temporarily owned by group 'lehrer', 
      because sophomorix does not run setgid root
     (this could cause problems, when using grpquotas (No problem now!))
   - think about copy/delete for rsync
   - how should it be managed to clear a  _Collect directory?
     (dont do this at all?)
   - when doing --(no)share, then dont do it for teachers


   --common naming with windows,novell ZEN:
     Naming:
       Menu: Klassenarbeiten
             Klassenarbeitsmodus (aktiviert=green, deaktiviert=red)
     - teachers aktivates modus
     - pc-based login (reason: limited gruppenrichtlinien, if used)
     - relogin is impossible
     - no internet   (make it choosable in linux-ml)
     - no exchange dir 
         - users can exchange on writeable programm share
           when bad software must be used thar requires write access
     - no mail
     - collect data in a special dir
          from _einsammeln
          to   _einsammeln/klasse/lehrer_datum_uhrzeit


     austeilen (homeverzeichnis): - cp data 
                - change the owner
                - 'save' button after editing
          from _austeilen/gruppe
               _austeilen/aktueller_raum

old:      to   _austeilen/klasse/lehrer_datum_uhrzeit/*files
better:   to   _austeilen/lehrer/*files

          _austeilen/klasse: files are missing, because they are moved

           (moved to _verteilt/klasse/lehrer_datum_uhrzeit)
       
     vorlagen (bereitstellen):
                - a class/project/subclass must be given  
                - use links to share data 
                - data is readonly  
                - 'save as ...' is necessary

     new features: - select data to distribute 
                     (different groups in one room, exams!)
                   - use empty or known password, 
                     loginscript changes password to arbitrary
                   - after login, student has to type in his name




sophomorix-check --cron 
   - zip files in /var/log/sophomorix/exam


Functions in SophomorixBase:
   - code cleanup


############################################################
ALL SCRIPTS To do
############################################################

   - show quota values larger than 9999MB as GB
     9999 -> 10G  (what about accuracy?)
   - if a class is to be added and the groupname is given to a project already
     make something correct
   - remove global variable alle_verzeichnis_rechte
     (sophomorix-split needs return value, sophomorix-add not ???)
   - /home/share/tasks/dachboden is of no use?
   - remove compatibility-mode to ml 1.1.1
   - replace sperrklassen.txt and entfernklassen.txt with filter.txt
   - test csv-output on windows and linux
   - clear a user: (The same as clearing a workstation after the exam)
           - keep his login, passwd, homedir
           - keep entry in database
           - restore directories (sammelordner, ...)
           - restore permissions 
        but:
           - empty its home (with options)
           - delete all mail (with option)
           - delete all files in share dir (with options)
           - linux-dotfiles only (with options)

     (Status C = can be cleared, sophomorix-clear, ...)

   - read the config-files from thomas
     (file:  debconf datenbank, perl-lib zum auslesen benutzen ist dabei)
      - debconf-show linuxmuster-base
         zeigt alle werte von linuxmuster-base
      - echo get cupsys/raw-print | debconf-communicate | awk '{print $2}'
         (' ist shift-#)
         liest einzelne Werte aus

   * set/check file-permissions at the and of each sophomorix-* run. 
   - unify the options for all scripts (create rfc), where a common
     naming system is used, i.e what options are used to refer to a AdminClass:
         -c AdminClass --class AdminClass --adminclass AdminClass
         ...
   - add references to all other man pages in every man-page



############################################################
DATABASE To do
############################################################
Postgres:
   - dump old database, before doing anything
                 pg_dump ldap > file.sql


SQL-DBI/OpenLDAP related:

- Transaction: combine inserts in create_user_entry 
- Load DBI (use:DBI;) only if necessary
- update database: combine select and updates to transaction
- NextFreeUnidId beim update ausnehmen

- avoid inserting an identical,existing line once again
  --using SQL
  (SQL can't do that)



############################################################
LDAP To do
############################################################




############################################################
SAMBA To do
############################################################

Samba net Befehl ansehen




############################################################
IMAP To do
############################################################

imap:  call
system("su --command='mkmaildir' postgres")   ????????
 
check if dir exists /var/lib/cyrus  ??? kommt mit paket

paket: cyrus21-imapd




############################################################
MOODLE To do
############################################################




############################################################
Administration Software
############################################################

Administration software:
   schueler.txt:   class;lastname;firstname;birthday;unid;department;
   lehrer.txt:     class;lastname;firstname;birthday;wish-loginname

Software Vendors:
   - SPLAN
   - IBIS
   - LUSD (mandatory in Hessen, Germany)
   - Schulkartei




============================================================
============================================================
Think about:
============================================================
============================================================
   - tar.gz-ing /var/www/people when deleting a user
     (for teachers only)
   - cups 
   - moodle (add users to classes, add teachers to admins)
   - deleting /home/exams
   - create loginnames initial.name.birthday
     (what about changes to this data)
   - sophomorix-info for ALL users (show my account data)
   - make standard-passwort linux configurable
   - commands for every user (sophomorix-show-my account, ...)
   - quick-self-add-mode
   - Mail notification for events (i.e. new student in your class, ...) 
   - use of sperrklassen.txt or entfernen.txt (-> filter.txt)
   - think about getting user in class lists from the database
     for correction of exams, ...
   - think about lehrer.txt handling
     allow comments to be added in a new field
   think about ext-lehrer (teacher fo only one class).
     probably needed for vhs-Kurse, etc., ...
   - think about acl's and their handling in repair-directory
   - think about self adding of users
   - think about grpquota in projects
   - think about manually moving students in other classes
      - restrict manually moving to Permanent,Frozen?
      - manually create classes for Permanent
        or automatically create a class permanent, where all Permanent/Frozen users 
        a moved to?
        do they have an exchange directory?
   - Think about removing ALL files of a user when she is deleted
     (find /home/share ... and kill them)
     think about renaming every file in an exchange-directory
     of a user that wil be killed shortly to
       filename.txt   -> will_be_deleted_filename.txt
   - easy to hook in prefilter-scripts, that are run automatically




############################################################
STANDARDS:
############################################################
SCHULKONSOLE:
   - we are using perl (Nov,2005)


Quota in /var/www/people ?
without individual quota. owner of all uploaded files is www-data

The group teachers is added with mailaliases:
sophomorix-class --class teachers --mailalias

Standard alias is vorname.nachname



############################################################
INSTALLATION TESTSERVER:
############################################################

openldap 2.3.x is necessary (use our package)


A) Installation from Debian CD's
==================================================

1. install debian sarge

2. edit /etc/apt-sources.list

   add deb cvs.bszleo.de/sophomorix ./ 

3. apt-get update   

4. apt-get install sophomorix2 sophomorix-developer

  Hit RETURN to all questions

5. run the following script:
       sophomorix-test
   this will test your system
   (if all test are ok, you are ready to use your server,
    if not: send mail)



B) Installation from LMZ CD's
==================================================

CD-Installation:
  - boot with option    auto26 or expert26
  - reboot without CD
  - internal NIC: eth1
  - externel NIC  eth0
    (vmware: eth0 is the card on top: briged)
    (vmware: eth1 is the card on the bottom: host only)


Testing lml3 in Network with 2.x:
 - set dhcp-range in both ml to nothing
   ml3: uncomment rangesetting in /etc/dhcp/dhcp3.conf


############################################################
RELEASES:
############################################################

? Workstation
   view fÃ¼r workstationaccounts (mit $)
   view fÃ¼r workstationuser

lehrer.txt zusatzfeld 'comment' (Platz in Datenbank suchen)

   sophomorix-setup-pgldap

   ??? folgendes ist eher schlecht

   Options --deb         (debconf-datenbank)
           --file        (/etc/sophomorix/pgldap/pgldap.conf)

           --Kommandozeilenoptionen

   SID: -- Beim erstanlegen in debconf-Datenbank wird SID gespeichert
        -- Beim Netbiosnamen Ã¤ndern wird  
           vom linuxmuster Setup script

           linuxmuster/sambasid   

        -- Option --force-sid (forced die sid auch in schon 
               vorhandene UsereintrÃ¤ge in pg)

   NETBIOS Name:

         muss von sophomorix-pgldap-setup angepasst werden
         (evtl. mit --new-netbiosname)


   backpgsql zusÃ¤tzlich im slapd -lml paket von Thomas S.


        sophomorix-setup-pgldap: database cannot be dropped, if user is connected
        (throw out users or what?)
        ldap vorher beenden.


        function  manual_delete_groups 
        (deletes a group altogether from the database)
        - check function
        - intelligently remove groups

        Funktionen fÃ¼r API:
         %data=get_userdata(user);
         SchlÃ¼ssel wie in der Datenbank
         $name = $data{'name'};

         Database fields for cups (what is needed?)

         counting the users when sophomorix-class -i
         SELECT count(uid) FROM posix_account;
                 * alle Zeilen
                 uid alles wo uid NOT NULL

         SophomorixAPI to select users and groups


         test login


         make sid available in ldap

         save sid in database

         use transactions to modify the database
         (this is more complicated, than I thought)

         add tests to sophomorix-test (check groups, check_provided_files)

           

   - smbldap-usershow entspricht in etwa sophomorix-user
   - system() in perl mit sysrun tauschen (oder noch besseres)

   - use groups_admin in display ???
  
   - removing a project:
      - remove also project_memberships
      - remove all links to this project
      - ..


   - Disabling a project:
      - remove users,admins,groups,projects from this projects
               (Make the empty -> nobody is user in this project anymore)
        backup this membership data in a log-file
               to reactivate the group, issue sophomorix-project ...
               using this Data

     /var/log/sophomorix/project-modify.log
     /var/log/sophomorix/project-modify-archive.log



Performance bug:
Reactivation is very slow (when a user reappears in schueler.txt)


------------------------------------------------------------
Code cleanup
------------------------------------------------------------
- move show ... loaded to higher loglevel
- move show Language ... loaded to higher loglevel

- use perl tidy

- remove?:  get_adminclasses_sub_school
            get_projects_school
            get_rooms_school (schneller)
            get_workstations_school (schneller)

show_....list:
should call fetch ... and just display the results
(avoid code doubling)

------------------------------------------------------------



- check what to do with quota, when removing a user???


- use mailaliases,mailist in subclasses ???? (do this later) 


tut noch nicht:
- Begriffe 'standard-lehrer', standard-schueler aus quota.txt,mailquota.txt 
  (auch entsprechende Englische zulassen:
      standard-teacher
      standard-student
      standard-workstation
  )


- create_user_db_entry: parameter mailquota
  (is this necessary ?)


what about setting quota/mailquota for domcomp,workstation,Administrator ...




BUG: skip empty lines in config files (review that)


Name avoidance: (problems with mailinglists):
avoid naming a longname/name of a project like:
  - another project
  - another group
  - anothers project longname

avoid adding a adminclass with the name/longname of a project






IS THIS REALLY NECESSARY
 table subclass_details
  class_details.type not necessary
  dont add to class_details, when adding a subclass
  view subclassdata
NO VIEW subclassdata (so far)


deleteadmin_from_pro : Fehler abfangen
usw. alle fetch_ delete ... durchguggen


meeting 21.3.2006

NOT creating a dir  in galli/_vorlagen and others, when user is added 
to a nonexisting class



invent sysrun??:
sysrun needs package libsysadm-install-perl
and use Sysadm::Install qw(:all);



NEXT:

create a group students with all students (for testing) 
sophomorix-projects --update-studentsgroup
on hold


Schulkonsole:

funktion zum Tauschverzeichnis lÃ¶schen
funktion zum ALLE links wiederherstellen


beim cp von netlogon stimmt was nicht




zusammenarbeit mit Schulkonsole:

variablen nutzen siehe perldoc Sophomorix::SophomorixAPI

1) alles was aus SophomorixPgLdap gebraucht wird in
   SophomorixAPI eintragen

   Liste function1,function2, ...

   Reihenfolge ergibt wichtigkeit

   -- bisher noch nichts


2) jeffbeck verschiebt die Funktionen und dokumentiert sie

   problem beim verschieben
       function wird in anderem paket gesucht


   -- spÃ¤ter

   gibt es tools die funktionsaufrufe suchen und in einem script 
   zeigen, welche funktionen aus anderen Paketen verwendet werden??

   etags, ctags fÃ¼r perl?


   Klasse Error 
   /usr/share/schulkonsole
   use Schulkonsole::Error;



   zuerst linuxmuster-base, svn auschecken, debian paket machen
   URL:  https://hostname/schulkonsole/

??? smbldap-useradd adds user also in the secondary group ??? check this



TESTS:
- existence of new dirs from 1.6.1-1
- switching shares on/off
- creating data in tausch an being moved. Is data moved with user in home?



RENAMING loginname of a user:
- update DB
- update lehrer.txt (wishlogin)
- update /etc/mail/aliases (run sophomorix-mail)
- create mail alias for old loginname?
- mv homedir 
- mv maildir (rename account??)
- (mv webmin stuff)



variablen in SophomorixPgldap scheinen global zu gelten.
SphomorixBase: remove unused functions



Projekte:

Austritt aus Klasse/Projekt/:

Ordner bleibt erhalten wenn nicht leer, User bekommt lÃ¶schrecht (owner)
Schulkonsole.

Bei wiedereintritt soll Ordner mit korrekten Daten da sein



Is this necessary?
====================
add a field male/female to lehrer.txt
make configurable if a 
Lehrerinnen-Liste 
Lehrer-Liste
Kollegium-Liste
is created



userliste in allen sophomorix-*:    -u --users user1,user2,...
  - sophomorix-kill
  - sophomorix-add
  - sophomorix-move
  - sophomorix-repair
  - sophomorix-kill

subclassen als projekte hinzufÃ¼gen? Tut das?


BUG: /etc/aliases root.root 0644  (who changes this values) 
sophomorix-mail does not change these values (but should do it with umask)


double loginname: 
newer user receives NO alias
older user keeps alias
later: override with database entry

.locked in __einsammeln
           cups-pdf


speed up the call to sophomorix-quota in
sophomorix-kill ??
the following way:
does quota need to be removed when killing a user???
  


Multi-Treffen:

Feature Request:
  - austeilen an lehrer soll gehen (auch an einzelne)
 
IMAP-cyrus
 - bisher noch keine subdirs im cyrus
 - wenn ein user kein postfach hat mit *-repair oder *-quota anlegen
 - postfÃ¤cher sind in /var/spool/cyrus/mail/
 - maildir-format
   Konvertieren: /usr/share/doc/cyrus(-common)/example/mbox to cyrus oder so





lml.mine.nu schulkonsole/shtml: descriptions


sophomorix-user: remove getpwnam???
save_tausch_klassen: getpwuid ersetzen.
getgrnam 
   bei collect in SophomorixBase
   sophomorix-subclass
   sophomorix-repair



log_script_exit:
use parameter to create return value for all exits

   Info: RÃ¼ckgabewerte scripte 0-127 (evtl. 255) (ab 2 benutzen)
   z.B. mit exit 7;

   Return Values:
   ?   script called with wrong options






show return values of scripts:
ls -al [return]
echo $?




check list of systemusers in debian developers manual


when a teacher/students is disabled remove him from /etc/aliases???






use field 'scheduled_delete' for teachers (and other users) in the database
sophomorix-check --cron to 

   1. send mail to the teacher and a copy to root 
   - you will be removed from the system
     in xxx days aaa happens toleration
     in yyy days bbb happens
     list of files in the exchange dirs
     files in apache are kept
     email will be deleted
 
     please reply to root@xxx.de or contact the administrators
     if that is not correct

   - add  '### scheduled_delete 60::90### before the teacher entry in lehrer.txt
     where 60::90 is xxx::yyy
     (this has to be done at the start of sophomorix-check --cron)  





sophomorix-repair options:

--delete-from-homedir path-to-file

go through all homedirs to delete the file $home/path-to-file

--delete-old-dotfiles path-to-/etc/skel

    - read all files from path-to-/etc/skel and create md5sums
    - go through all homedirs
      delete the files that exist in path-from-/etc/skel 
      in the homedirs when they exist and and are NOT modified


when a user that exists (wwwadmin) and no quota in quota.txt is given,
there is a warning (check if the script is interrupted)


add a custom login-info:

first line: REPLACE_TEMPLATE=no  (add the contents to the template)
                             yes (replace contents to the template)





sonstiges

http://ekiga.net/

mediawiki mit .htaccess absuchern (aktuelle ct, 26.9.06)



KNOWN BUG: smbpasswd -d user tut nicht bei usern mitÃ¶Ã¤Ã¼ÃÃÃÃ.


Feature Request:

Klassen/Raum/... wechseln. wieso nicht schon, wenn ich im pulldown
menue was wÃ¤hle (Wechseln-button weglassen?)

Austeilen an einzelne Lehrer/Alle Lehrer wÃ¤re mÃ¶glich, wenn
im Klassen wechseln menue die 'Klasse' Lehrer(Kollegium) erscheinen 
wÃ¼rde.

Andere ML's haben bunte KnÃ¶pfe in der Schulkonsole, linux nicht? 
Why? Styleguide?




print Befehl (in Werkvertrag ergÃ¤nzen):

sophomorix-print --classlist klasse --postfix username
(oder statt --postfix ... --caller  : so wie bei der Passwortliste erstellen)
Die Dateien entstehen in /var/lib/sophomorix/print-data/klasse-classlist.csv
bzw. *.pdf


printing userlists: print *.csv *.xls of classes in schulkonsole
ist there a independant spreadsheet::write (like Spreadsheet::Read)



check teachers, lehrer   different naming

if teacher is scheduled_tolerated, it cant be moved to the attic
after ONE run of sophomorix-check
It can be moved after the second run


sophomorix-developer:
script to create a IDE: 
- emacs21
- perldoc
- cvs and checkout of sophomorix2



############################################################
Cron Jobs
############################################################
see manpage for run-parts for checking cron jobs
cronjob execution sends mail
cron itself doesn't log use logger

add a cronjob?  (weekly) with  "exec? quotacheck -a"  S. 147/151 LPI(O'Reilly)
add a cronjob?  fsck (so that no fscheck is necessary when rebooting)




############################################################
sophomorix-vampire
############################################################

sophomorix-project
   --lock / --unlock / --skiplock

   create/delete /var/lib/sophomorix/lock/project.lock
   if lockfile exists, interrupt sophomorix-project without modifying anything
   useful when migrating, updating, ...

sophomorix-class --dump
   dump ADDITIONAL data of a class: maillist,...
   to be used ba sophomorix-vampire   


############################################################
Next Meeting:
############################################################

- freeze users as paedagigical measure?
  what must be frozen?

- create command to lock access to schulkonsole

- when log in (from thomas script) is created, then log information to see
  which teacher is in which room, -> create a maillist for the room automatically



############################################################
updateable package:
############################################################


BUG: (check this)
mein Testsystem: das tut (LANG ist )de_DE@euro)
ml3cd: LANG ist leer
(mail sent)
man sophomorix-mail : es wird zuerst nach der nicht existierenden
en manpage gesucht un die Deutsch nicht gefunden, obwwohl existent.

created request in RT


next: use pid of lockfile

next: put send_mail in a function:
   - recipient-list, commaseparated, add @domain
   - cc list
   - template-name
   - replacements for template

files:
   name-body.de
   name-header.de

replace name with: 
   mailquota_warning,
   project_deletion_warning,
   ...

database-field my language??

man 5 schueler.txt, ...
 


Unterordner spam anlegen: spam (ordner-trenn-parameter . oder /)


sophomorix-project -i -p name

-v unfolds membergroups
-vv shows alphabetical list of all users
    and the membership reason:
         user1 (admin)
         user2 (admin)
         user3 (member_by_option)
         user4 (member_group: m2kb3t)
         user5 (member_group: m2kb3t)
         user6 (member_project: project1)
         user7 (member_project: project1
                                -> project2)

use this to check information:

drop all secondary group memberships 
      find out if this user is admin
                            is member_by_option
                            is member by group
                            is member _by project
                            is member by project-> project
there must be no users left

if left: Warning: no reason for membership of userx

check the other way around:
list members of memberprojects, membergroups and check 
membership



create more tests for projects


make function fetchinfo_from_project return something useful, when 
project does not exist 


vmware:




Fernwartung:

mehrere Mailadressen, falls es probleme gibt

mails verschicken per cron oder scripte von Nagios abprÃ¼fen lassen?

verÃ¤ndeungen durch remote admin loggen
a) Zugriff jederzeit durch support mÃ¶glich
b) Zugriff nur per Erlaubnis



next steps in sophomorix-vampire:

replace cp /etc/passwd with getent passwd > file;scp file

check if sophomorix-check --use-gid works
                          --use-uid
                          --no-kclass needed?
                          update man page


nagios
https://servername/nagios2/


mail an hoth wegen tickets, running

#129: close it
#130: close it when passwords work
  

 
create forbidden projectnames 
   - NOT existing classes
   - NOT existing classes-[A,B,C,D]
   - NOT existing projects



use new configuration files when 

resetting a user

make him a member in a project,

move him, ...


Think about, if something has to be done with permissions, when a user 
comes into the attic (make sure user cannot cause trouble)

add more permission tests to SophomorixTest.pm
   - test also $mygroup stuff

 
performance

add parameter $regex to repair_repairhome:
not set ALL permissions from repairhome.usertype.
set only for lines matching $regex
$regex van be $mygroups 


sophomorix-repair:
add option --repairhome-path path/prefix
to read repairhome permissions from 
   - path/prefix.student
   - path/prefix.teacher
   - path/prefix.workstation
   - path/prefix.attic
script must exit, when one of these files are missing



Which gowner must be forced when
   - in sophomorix-move (chown -R .gownwer ...)
   - in function handoutcopy

idea: when smb.conf has no content for gowner, then use 
      the users primary group (that what would happen without force group)


smb.conf force create_mode, create mask dito. for dirs


make use of __dachboden when removing dirs (user exits project, subclass, ...)

chown without file Fehlermeldung in sophomorix-move


how handle htaccess when user is in the attic (type attic)?

INFO:
%all_repairhome contains all permission in $HOME


BUG: if sophomorix-test is run, then
     /var/www/people/students/oeztuemeo/...
                     teachers/darmin/...
     still exists



Permissions:


/home/students/$klasse/$schueler    $schueler.teachers    3751
(Die 3 von 3751 bewirkt, dass die Gruppe teachers geforced wird.)

Im Tauschverzeichnis gehÃ¶rt alles der Klasse.
/home/share/classes/$klassen     administrator.$klassen    3770 



MIGRATION:
sophpmorix-vampire:
Programdir:
make owner recursively to administrator:domadmins (file:dir 664:775)

wenn die Daten auf den neuen Server migriert werden,
dann sollen die die Rechte haben: 2644/2755, owner:group
(bisher 0700/0700 owner:group)


evtl. Bug: does a user has to change its password when he first authenticates 
           AND $student_samba_pw_must_change="yes" in sophomorix.conf?



To check:

db name ldap is not correct anymore?

Verwirrend ist m.E. noch der Unterschied zwische
workstation-account(=Klassenarbeitsbenutzer) und Computeraccount
($account), da in der engl. Literatur beim $account vom
workstationaccount (z.B. accountflag W) gesprochen wird.

Ich wÃ¼rde es gerne in der ML3 so machen

ComputerAccount  : $-Account
ExamAccount      : Klassenarbeitaccount/PrÃ¼fungsaccount


Das wÃ¼rde bedeuten, das Gecos-Feld, cn=, und die optionen bei den Befehlsaufrufen 
anzupassen(statt --workstation --examaccount).



Interface to create/manage accounts:

- Create group for room:
----------------------------------------
not necessary, groups are added when user is added
(replaces smbldap-groupadd -a <raum>)

- Create Workstationaccount (Klassenarbeitsnutzer)
----------------------------------------
sophomorix-useradd --workstation <wsname> --unix-group <raum>
(replaces 'smbldap-useradd -a -d <homedir> -c HostAccount -g <raum> -m -s /bin/bash
<hostname>')

- Create Computer account
----------------------------------------
sophomorix-useradd --computer <hostname$>

replaces:
1) smbldap-useradd -w -g 515 -c Computer -d /dev/null -s /bin/false <hostname>$

2) smbpasswd -u -m hostname (without $)

3) smbldap-usermod -H '[WX]' <hostname>$

Delete an account:
----------------------------------------
sophomorix-kill --killuser loginname1,loginame2,...   
($ mit Ã¼bergeben im loginnamen)
(replaces smbldap-userdel <hostname>)

To do : Delete a room group
----------------------------------------
smbldap-groupdel <raum>
  - is project removed completely?
  


Set a password of a user:
----------------------------------------
sophomorix-passwd --interactive --user name 
(replaces 'smbldap-passwd name')




sophomorix-useradd:

set quota when needed

wwwadmin should have /dev/null as home

add option for this
 



Problems:


add some checks to auth_* functions, (see ?????)


Careful:
--------------------
sophomorix-useradd --workstation ... no homedir created

adding a workstation does not add class-dirs and user-dirs
(this does the script of workstation import)

deleting groups does not delete workstation dirs

This should be moved to the sophomorix-scripts



sophomorix-repair repariert workstations im falschen Verzeichnis
check this


Checken:
Die Abfrage zum Finden von Schuelern sieht bei mir in etwa so aus:
SELECT uid FROM userdata
  RIGHT JOIN classdata ON userdata.gidnumber = classdata.gidnumber
  WHERE classdata.type = 'adminclass'

D.h. also alle Accounts, die als Initial Group eine Klasse haben, die
vom Typ adminclass ist.


wwwadmin account should not be windows account
check if this is correct



add parameter to auth_groupadd: unixonly
  if unixonly==1 -> do NOT issue net groupmap command 
               0 -> do     issue net groupmap command
check if this is the difference from a group appearing in windows


komischer Wert bei slapcat:
sambaDomainName:: c2NodWxlIA==



Bugs:
# 117
# 238 schreiben in __vorlagen und __tauschen


diff pg to ldap:
  - use it in sophomorix-sync-check
  - with -vv make it more noisy (show what is has found)


Bug (cosmetical):
fetch_ldap_pg_passwords finds lines twice (they exist only once)

Check: 
frueher: smbldap-useradd legte homedirs von examaccounts an
neu    : sophomorix-useradd macht das nicht mehr
beim nutzen der examaccounts werden diese erstmal zurÃ¼ckgesetzt
also werden die homes nicht gebraucht


add more check of ldap attributes to tests, and compare (sophomorix-user)


sophomorix-sync users: add ldap comparison

test stuff, that is only in ldap???




upgrade:

To do Beck:
given Name: 'Vorname' is not existing 
(no smbldap-usermod option for this)





ich hab mal ldap mit smbldaptools befÃ¼llt(=mit sophmorix) und dann mit
smbldap-usershow angezeigt Dann habe ich deine scripte angewendet und
den ldap-baum neu erzeugt um ihn dann neu anzeigen zu lassen mit
smbldap-usershow.

Eigentlich sollte der dann aufgebaute ldap-Baum gleich sein.

Das ist so, bis auf folgende Ausnahmen:

1)
Beim $-Account steht:
dn: uid=test12$,ou=accounts,dc=linuxmuster,dc=de

muss ou=machines stehen

Alle $-accounts mÃ¼ssten also mit ou=machines gedumpt werden.



2) Reihenfolge in objectClass ist anders: 
Hat keine Auswirkungen


3) sambaprimarygroupsid (postgres) bzw. sambaPrimaryGroupSID(ldap)
ist z.B. S-1-5-21-1800012640-1621739038-321154774-515 fÃ¼r $-accounts, wenn mit 
smbldaptools angelegt (letzte Zahlen sind unix-group id)

bei unserem bisherigen setup (postgres alleine) wird die letzte Zahl berechnet
nach 2*unixgidnumber+1001

Das wÃ¼rde bedeuten: 
A) nach dem anlegen S-*-515
B) nach dem ersten dump 2031 

Was ist nun richtig?
Soll ich in der Datenbank auch mit *-515 anlegen?


4) givenName
DafÃ¼r gibts in den smbldap-tools keine Option. Das bedeutet:
A) nach dem anlegen ist givenName leer.
B) nach dem ersten dump ist givenName ausgefÃ¼llt

(Da mÃ¼sste ich also nachbessern: givenName beim Anlegen )

Ich denke nicht, dass uns das stÃ¶ren wird. Aber vielleicht gibts einen
technischen Grund dass man den givenName immer braucht.




add option --ldapsearch to sophomorix-dump-pg2ldap:

use ldapsearch instead of smbldap-usershow and compare these values as well

ldapsearch -x -D cn=admin,dc=bszleo,dc=de -y /etc/ldap.secret uid=roe >/root/log3

oder .ldaprc anlegen mit

BASE  dc=bszleo, ...
BINDDN cn=admin,dc=...
HOST localhost


sophomorix-vampire:
care about printers,
sort them out of wimport_data



slapd.conf
by read
check this with tho

sind die indexe noch notwendig in postgres?

auth_adduser_to_project doesnt check if user is in this group.
creates smbldap-usermod -G administrators,administrators

add a working hostname function (hostname -s )


HORDE STUFF:

avoid that users can sent mail with arbitrary names

Remove from_addr and identities stuff:

DELETE FROM horde_prefs WHERE ((pref_name='identities' OR pref_name='from_addr') AND pref_uid='bz');

IDEA: Remove this stuff and recreate it with decent values.

Dump one INSERT per line:
mysqldump --extended-insert=0 horde > file.sql




TODO in 1.9.29:

check if computer$ are dumped to ou=machines

checkin from svn the following files:
        smb.conf
        logon.bat
        login.bat
        common.bat


Todo:
 

Schulkonsole-Befehle zum internet sperren usw.

noch (scheinbar) angemeldete user loeschen:
rm /var/cache/linuxmuster/logins/*

/usr/share/linuxmuster/scripts/urlfileter_on_off.sh







sophomorix-groupmod, ... Befehle (Liste von Thomas)
user in zusÃ¤tzliche sekundÃ¤re gruppen eintragen/austragen in (pg und ldap) 


sophomorix-lock

mehrmals probieren,nach 2s Pause
nach 8s beenden



sophomorix-print
   - do somthing useful when latex hangs


sophomorix-mail: auch nur 1 usermailbox anzeigen lassen

sophomorix-passwd: option um firstpassword zu leeren leeren (password bleibt gleich)


NEXT:

sophomorix-kill --allstudents  
                --allteachers
                schueler.txt,lehrer.txt umbenennen
                Daten auch lÃ¶schen

avoid double code:
marriage: sophomorix-check line 2310 ... check this


man sophomorix-passwd:
welche Zeichen sind als Passwort zulÃ¤ssig:


error: when a user is killed,
       she was not deleted from members_projects
   Write a cleanup script


sophomorix-test:
sophomorix -F mahnol
Use of uninitialized value in string at /usr/sbin/smbldap-usermod line 458, <DATA> line 283.


Problem: der erste ist angelegt, der zweite kommt dazu

11A;Paice;Ian;12.04.1974;1234;
11A;Paice;Jan;12.04.1974;





wir haben nun wiederholt beobachtet, dass sich beim Anlegen neuer
Benutzer Ã¼ber die Schulkonsole das Schulkonsolenpasswort einiger
(nicht aller) bereits bestehender Benutzer Ã¤ndert. Das betrifft auch
"nur" das Passwort fÃ¼r die Schulkonsole, die betroffenen Benutzer
kÃ¶nnen sich weiterhin am System anmelden. AuÃerdem komisch: wenn man
sich die PasswÃ¶rter dieser Benutzer dann anzeigen lÃ¤sst, haben sie
alle dasselbe Erstpasswort (eingestellt ist Zufallspasswort).  Machen
wir etwas falsch oder ist das ein Bug?

Danke und GruÃ,

Jochen Rupp
KKS Esslingen




Treffen:

    - passwortÃ¤nderung bei erstanmeldung, 
    # 134 bug Zeilentrenner
    # 208 bug tritt nicht wieder auf
    - windows-PasswortÃ¤nderung
    - sophomorix-support Befehl
    doppelte Doku:
      --sophomorix-vampire
      --sophomorix fÃ¼r experten


sophomorix-groupdel erweitern um 'leere' klassen zu lÃ¶schen
can sophomorix-groupdel delete an empty adminclass group?
- add option to do this

sophomorix-usermod um user zusÃ¤tzlich in einer Gruppe einzutragen:
  hauptsÃ¤chlich admins in zusatzgruppe


sophomorix-useradd:

Beispiele in manpage:
1) user areca mit password, das in webfrontend eingetragen wird

sophomorix-useradd --unixadmin areca --unix-group areca
   Edit quota.txt
   Edit mailquota.txt
   sophomorix-mail --add-mailbox areca
sophomorix-passwd --interactive -u areca
sophomorix-quota

PrÃ¼fen:

sophomorix-mail --showmailboxes | grep areca
quota -v areca

Problem: nach sophomorix-dump-pg2ldap ist es ein samba user!







2) weiterer pgmadmin
     win und unix, in gruppe pgmadmin
     wwwadmin ist in keiner Gruppe?!
     (domadmin ist type domaingroup)


sophomorix-teacher --showclasses
                   --showteachers
                   mit optionalem Argument lehrerlogin
                   zeigt nur die Klassen dieses Lehrers
evtl. neue option showteacher login (ohne s)


To check:

- wie kann man das /var/www/people/students lÃ¶schen, wenn man nicht weiss,
  welcher ob der user im attic in teacher oder students war?  
  (Use ExitAdminClass)



Aike:

1) Problem: sophomorix-locked 
   LÃ¶sung: A) Anzeige in schulkonsole erforderlich
           B) Knopf unlocken

   - Ãnderungen fÃ¼r Aike: 
                  - bei allen Seiten, die sophomorix-Befehle aufrufen:

                  - lesen von /var/lib/sophomorix/lock/sophomorix.lock
                     ...::scriptname::prozessid::

                  und folgende tests machen:

                  A) testen, ob lockfile existiert
                  B) wenn ja, schauen ob prozess mit 'prozessid' existiert

                  A) nein ---> weitermachen wie wie bisher
                               (Entsprechende Seite anzeigen)
                  A) ja B) ja --> Text: 
                                  Es wird gerade ein Befehl ausgefÃ¼hrt
                                  Versuchen sie es spÃ¤ter nochmal
                         
                  A) ja B) nein --> Informieren sie den Administrator

                  Achtung: Zwischen A und B vergeht Zeit, deshalb :
                  Nach A), B) NOCHMALS A) prÃ¼fen:
                  nur wenn Inhalt des lockfile bei A) 
                  GLEICH wie beim ersten prÃ¼fen, 
                  dann: Informieren Sie den Administrator 

                  Knopf fÃ¼r administrator: Wo? Andy ???

                  Unlocken:

                  Aufrufen von: sophomorix-support --unlock
                                (existiert erst ab sophomorix 1.9.31)
                                (oder sophomorix-check --unlock,
                                 das gibts schon lÃ¤nger)    
                  Das macht folgendes:
                  - sichern von /var/lib/sophomorix/lock/sophomorix.lock
                  - sichern der letzten 30 Zeilen von 
                       /var/log/sophomorix/command.log



2) zusÃ¤tzlich eine checkbox/Button in der Schuko des administrators 
   Wo ? Wo admin alle Klasse sieht Andy ???
    
   zum verstecken/wieder sichtbarmachen einer Klasse:

   Befehle:
       /usr/sbin/sophomorix-class --hide --class 10c
       /usr/sbin/sophomorix-class --nohide --class 10c
      
 

3) Problem: sophomorix-www loggt nicht mit, wer eines SchÃ¼lers 
           Homepage freigegeben hat.
  MinimallÃ¶sung: Loggen in command.log 
        (evtl. zusÃ¤tzlich in die .htaccess-Datei rein)
      Aike: sophomorix-www immer mit Parameter 
         --caller login 
         aufrufen, sonst weiss sophomorix-www nicht wer 
         in der Schulkonsole diesen Befehl aufgerufen hat
  Die Option --caller login ist ab sophomorix 1.9.30 drin




4) Aike bitte checken:
  Auruf von sophomorix-passwd sollte mit ' ' erfolgen, also
  sophomorix-passwd -u bz --pass '{my#cking}Pass' 
  (wegen Sonderzeichen, ..)



5) offene und geschlossene Projekte

  Zur Klarstellung: Eigenschaft 'joinable'=true heisst von ALLEN Schuko Lehrern 
                    darf die userliste editiert werden.
    
                    joinable=false heisst, nur von den projektadmins darf die 
                    userliste verÃ¤ndert werden (und root)

  In der Postgres-Datenbank:
  Tabelle projectdata.joinable ist TRUE/FALSE  
  
  Todo fÃ¼r Aike:
  Schritt 1) Bei jedem Aufruf von sophomorix aus der Schulkonsole, muss der
             aufrufende Lehrer/User Ã¼bergeben werden:
             --caller lehrer1 
             (sophomorix prÃ¼ft dann, ob dieser user die userliste Ã¤ndern 
              darf oder nicht)    

  Schritt 2) Ziel: Wenn man an der Schuko nichts Ã¤ndern kann, 
             sollen auch keine KnÃ¶pfe usw gezeigt werden:

             Das betrifft 2 Seiten(A,B): 

             A ) Startseite -> hozizontal(gelb) -Projekte  OHNE Projektauswahl
                 Eintragen in Projekte SOWIE Austragen aus Projekten 

                 A1) In Projektliste zum Eintragen nur joinable=true 
                 Projekte anzeigen.

                 A2) Knopf zum austragen NUR zeigen, 
                     wenn das Projekt joinable ist.

             B ) Startseite -> hozizontal(gelb) -Projekte MIT AUSWAHL 
                 eines Projektes in dem man Mitglied ist

             Wenn das projekt joinable=true ist: wie bisher

             Wenn es joinable=false ist, und der eingeloggte 
             user IST admin des projekts: wie bisher

             Wenn es joinable=false ist, und der eingeloggte 
             user IST KEIN admin:


                  B1) Statt "Mitglieder hinzufÃ¼gen" + Such-Eingabefeld:
                      Mitglieder hinzufÃ¼gen ist nicht gestattet!
              
                  B2) Statt Knopf "Mitgliedschaft beenden" 
                      ausgegraute Schrift "Nicht gestattet"



so an Andy geschickt am 9.10.07.
 








sophomorix-teach-in:
Idee: auto-teach-in nur, wenn das anlegedatum WENIGER als 3 Monate 
(oder 7 Monate(erstes Zeugnis?)) zurÃ¼ckliegt? 
Variable time in sophomorix.conf



NEXT:
sophomorix-www -i 
  kann man .htaccess bei zÃ¤hlen ausnehmen?
  Der Lehrer, der die .htaccess verÃ¤ndert hat anzeigen
  (dort reinschreiben, kann man das www-mÃ¤Ãig sehen?)




sophomorix-passwd --pass 'my\file' setzt passwort nicht korrekt 
                  mit my\\file steht my/fie in der Datenbank

Beim versetzen in den attic,lÃ¶schen,... muss das public html auf
user-private-noupload gesetzt werden


In sophomorix-class -i --class name
              project -i project
                Zusatzinfos wie 
                    Gruppen-gidnumber,
                    Datenbank id,
                    ... 






###############################################################################
# postgres slapd -> slapd
###############################################################################
Überlegungen zum ersetzen der postgres-Datenbank mit ldap only:

Schritte:

1) ldap-Baum erzeugen
   Nach und nach werden weitere schemas dem ldap Baum hinzugefügt:
   -> sophomorix.schema, ....
   beim dump werden diese Felder gefüllt
   beim modifizieren eines accounts werden sie verändert
   ZIEL: + alle erforderlichen Daten aus postgresql in ldap
         + zusätzliche Datenbankfelder (siehe die Datei hier)
         + zusätzliche Felder für workstations
         + zusätzliche felder für linbo ?
         + ...
   Der ldap-Baum sollte gut getestet sein, damit er sich nie wieder ändert:
   - moodle, ...
   - mehrere Schulen, ....

2) sophomorix-dump-pg2ldap soll diesen ldap Baum perfekt erzeugen:
   -> wird zur Konvertierung von postgres nach ldap benutzt:
   vor upgrade auf ubuntu:
   A) sophomorix-dump-pg2ldap erzeugt ldap-baum bzw. *.ldif
   B) auf ubuntu wird diese ldif eingelesen, postgres nicht mehr nötig
   
3A) Schulkonsole fixen, soll nur noch ldap abfragen
3B) Sophomorix-abfragen fragen ldap statt postgres

4) Anlegen von usern, versetzen, ... nur noch im ldap


Problembereiche: samba 4, was ändert sich?




##############################################
new variables (add to new major release):    #
##############################################




sophomorix.conf:
# alias name for mailist teachers (must be activated)
$teachers_alias_name="lehrer";

# additional recipients for maillist teachers
# separate entries with commas
# use groups(classes) when possible
# Example:
# $teachers_alias_additions="secretaries,social";
# Where secretaries and social is a class from extraschueler.txt 
$teachers_alias_additions="blackmri,jonesjo";

# remove entries in schueler.txt with leading underscore
$underscore_klassen_filtern="yes";

# encoding of schueler.txt
# file_coding: 8859-1,8859-15,win1252,utf8 
$encoding_students="";

# encoding of extraschueler.txt
# file_coding: 8859-1,8859-15,win1252,utf8 
$encoding_students_extra="";

# encoding of extrakurse.txt
# file_coding: 8859-1,8859-15,win1252,utf8 
$encoding_courses_extra="";

# encoding of lehrer.txt
# file_coding: 8859-1,8859-15,win1252,utf8 
$encoding_teachers="";


New databse/Datenbank values:

Projects:

A) boolean switch for 'show the mailist' or not
show means: send monthly mail with maillists/ show maillists on schulkonsole

B) comment for maillist 'Verteiler fÃ¼r Abteilung 5'

C) Fields for suspending accounts
   ScheduledDectivation (gestern, heute, in zukunft)
   ScheduledActivation


###############################################################################
# Data for printout only
###############################################################################

# Full qualified domain names 

# from intranet (internal)
$server_fqdn_internal_print="";

# from internet (internal)
$server_fqdn_external_print="webmail.bszleo.de";

# samba domain
$smb_domain_print="BSZLEO";

# admins (instead of @ use \@)
$admins_print="Kai Beck (bec\@bszleo.de), RÃ¼diger Beck (bz\@bszleo.de), Norbert Fischer (fi\@bszleo.de) und Rainer RÃ¶ssler (roe\@bszleo.de)";


# auf 2005 setzen
$geburts_jahreszahl_stop=2001;






# change comment in for 

# Einloggen der Sch\ufffdler per ssh erm\ufffdglichen
# (yes -> /bin/bash) oder unterbinden (no -> /bin/false)
$schueler_per_ssh="yes";












############################################################
Old obsolete stuff
############################################################

sophomorix-webmin (obsolete in ml 3.0)
   - totally configure webmin
   - option --noninteractive 

   ** ml_account  : Benutzerkonto  (alle user)
   ** ml_teacher  : Unterricht (alle)
   ** ml_admin    : Administration


check: is user taken out of webmin, when she is Disabled? Is this necessary or is the !-sign in /etc/shadow enough?

miniserv.users: letztes Feld : hosts von denen man zugreifen darf 


   -  Be aware: problem group student would need 1 entrys for every student 
       (this will be a very loooooooooong line)

     problem: when a module is added to webmin.users only (own script)
              then this module is NOT added to webmin.acl 
                 -> the user doesnt see this module
           better: create webmin.acl from some configuration files
                   in /usr/sbin (webmin-teacher-modules, ...-admin-, -student-)
                   which can be overwritten by files in /etc/sophomorix/webmin

   - if users are added without webmin installed, root and admin are missing
      - create root,admin, when creating files
      - or better do nothing when they dont exist


   - usermin-modules will be converted to webmin by thomas
       -> usermin is not running on the ml-server
       -> postinstall-script muss sich in gruppe student, teacher eintragen
   -abfrage in sophomorix-webmin, ob paket webmin installiert ist



############################################################
Neue Datenbank Felder
############################################################

UserLevel:
   beginner
   intermediate
   expert
Zum Unterscheiden von Fehlermeldungen, Schulkonsolenfeldern

oder besser Rollen?

ScheduledActivation
   wann soll der user vom cronjob wieder aktiviert werden?


UTFName      oder adminName
UTFSurname

speichert die Daten so, wie sie aus dem Schulverwaltungsprogramm
kommen
